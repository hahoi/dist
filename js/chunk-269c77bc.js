(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-269c77bc"],{"616c":function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tree"},[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"6"}},[a("v-text-field",{attrs:{label:"關鍵字搜尋..."},model:{value:e.searchword,callback:function(t){e.searchword=t},expression:"searchword"}})],1),a("v-col",{attrs:{cols:"1"}},[a("v-btn",{attrs:{color:"info"},on:{click:e.searchFun}},[e._v("搜尋")])],1)],1)],1),a("img",{directives:[{name:"show",rawName:"v-show",value:this.$store.state.loading,expression:"this.$store.state.loading"}],attrs:{src:o("cf1c"),height:"40px"}}),a("v-tree",{ref:"tree1",attrs:{data:e.treeData,tpl:e.tpl,draggable:!0},on:{"drag-node-end":e.MyDrag}}),a("v-container",[a("v-row",[a("v-spacer"),a("v-col",{attrs:{cols:"6"}},[a("v-btn",{directives:[{name:"show",rawName:"v-show",value:!this.$store.state.loading,expression:"!this.$store.state.loading"}],attrs:{color:"info"},on:{click:e.saveCurrentState}},[e._v("儲存階層收合狀態")])],1),a("v-spacer")],1)],1),a("span",{directives:[{name:"show",rawName:"v-show",value:e.progressShow,expression:"progressShow"}],staticClass:"mx-10"},[a("v-progress-circular",{attrs:{size:100,width:15,value:e.progressValue,color:"primary"}},[e._v(e._s(e.progressValue)+"%")])],1),a("v-snackbar",{attrs:{timeout:e.timeout},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(" "+e._s(e.databasemessage)+" "),a("v-btn",{attrs:{dark:"",text:""},on:{click:function(t){e.snackbar=!1}}},[e._v("Close")])],1)],1)},n=[],r=(o("c975"),o("d81d"),o("b0c0"),o("d3b7"),o("25f0"),o("159b"),o("53ca")),s=o("9138"),c=o("6fa2"),i={name:"project",data:function(){return{alert:!1,snackbar:!1,timeout:2e3,databasemessage:"",searchword:"",treeData:[],progressValue:0,progressShow:!1}},components:{},created:function(){var e=this;s["c"].collection(s["a"]).onSnapshot((function(t){var o=t.docChanges();o.forEach((function(t){"added"!==t.type||e.$store.state.loading||(e.databasemessage=e.$store.getters.user.name+" 正在新增資料！",e.snackbar=!0),"modified"===t.type&&(e.databasemessage=e.$store.getters.user.name+" 已經修改資料！",e.snackbar=!0),"removed"===t.type&&(e.databasemessage=e.$store.getters.user.name+" 已經刪除資料！",e.snackbar=!0)}))}))},mounted:function(){var e=this;this.$store.commit("setLoading",!0),s["c"].collection(s["a"]).get().then((function(t){var o=[];t.forEach((function(e){o.push(e.data())})),e.treeData=c["a"].arrayToJson(o),e.$store.commit("setLoading",!1)}))},watch:{search:function(e){e&&e!==this.select&&this.querySelections(e)},progressValue:function(){this.progressShow=0!==this.progressValue&&100!==this.progressValue}},computed:{},methods:{querySelections:function(e){var t=this;this.loading=!0,setTimeout((function(){t.items=t.dbRecord.map((function(t){if(t.title.indexOf(e)>-1)return t.title})),t.loading=!1}),500)},searchFun:function(){this.$refs.tree1.searchNodes(this.searchword)},tpl:function(){for(var e=this,t=this.$createElement,o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];var r=a[0],c=a[2],i=a[3],d=r.selected?"node-title node-selected":"node-title";return r.searched&&(d+=" node-searched"),t("span",[t("span",{class:d,domProps:{innerHTML:r.title},on:{click:function(){e.$refs.tree1.nodeSelected(r);var t=r.title;r.title=prompt("請更改工作項目名稱：",r.title)||t,r.title!==t&&s["c"].collection(s["a"]).doc(r.id).update({title:r.title}).then((function(){console.log("Document successfully updated!")})).catch((function(e){console.error("Error updating document: ",e)}))}}}),t("button",{style:"color:blue; background-color:pink;border-radius:4px;",on:{click:function(){return e.asyncAddNode(r)}}},["+增加"]),"  ",t("button",{style:"color:red; background-color:pink;border-radius:4px;",on:{click:function(){return e.deleteNode(r,c,i)}}},["-刪除"])])},asyncAddNode:function(e){var t=this;this.$set(e,"loading",!0);var o=Math.floor(Date.now()/1).toString();o=o.toString();var a={title:"新增項目"+o,id:o,pid:e.id,expanded:!0,depart:"",enddate:new Date,startdate:new Date,status:"",process:[]};s["c"].collection(s["a"]).doc(o).set(a).then((function(){t.$refs.tree1.addNode(e,a)})).catch((function(e){})),this.$set(e,"loading",!1)},deleteNode:function(e,t,o){var a=this;"object"==Object(r["a"])(e.children)&&e.children.length>=1?this.$confirm("包含子項目，不能刪除！請先刪除子項目。"):a.deleteNodeHandle(e,t,o)},deleteNodeHandle:function(e,t,o){var a=this;this.$confirm("刪除後無法復原，<br>確定要刪除【"+e.title+"】嗎？",{color:"red",title:"嚴重警告(第一次)"}).then((function(n){n&&a.$confirm("此節點中的填報資料及佐證資料都會被刪除！<br>確定要刪除嗎？",{color:"orange",title:"嚴重警告(第二次)"}).then((function(n){n&&s["c"].collection(s["a"]).doc(e.id).delete().then((function(){if(console.log("資料刪除成功！",e.id,e.process),e.process.length>0){var n="/DESIGN/"+e.id+"/";a.deleteStorageFile(n)}a.$refs.tree1.delNode(e,t,o)})).catch((function(e){console.error("Error removing document: ",e)}))}))}))},deleteStorageFile:function(e){console.log("刪除fireStorage儲存的圖檔",e),s["e"].ref().child(e).delete().then((function(){console.log("File deleted successfully")})).catch((function(e){console.log("Uh-oh, an error occurred!")}))},MyDrag:function(){for(var e=this,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];var n=o[0];this.$confirm("你已經搬移了資料，確定要存檔嗎？",{color:"red",title:"警告"}).then((function(t){if(t)s["c"].collection(s["a"]).doc(n.dragNode.id).update({pid:n.targetNode.id}).then((function(){window.location.reload()})).catch((function(e){}));else{var o=e;s["c"].collection(s["a"]).get().then((function(e){var t=[];e.forEach((function(e){t.push(e.data())})),o.treeData=c["a"].arrayToJson(t)}))}}))},saveCurrentState:function(){var e=this,t=this.$refs.tree1.getNodes({});this.progressShow=!0;var o=t.length,a=0;t.forEach((function(t){s["c"].collection(s["a"]).doc(t.id).get().then((function(n){e.progressValue=Math.round(100*++a/o),n.data().expanded!==t.expanded&&s["c"].collection(s["a"]).doc(t.id).update({expanded:t.expanded}).then((function(){}))}))}))}}},d=i,l=o("2877"),u=o("6544"),h=o.n(u),f=o("8336"),g=o("62ad"),p=o("a523"),v=o("490a"),m=o("0fd9"),b=o("2db4"),w=o("2fa4"),k=o("8654"),$=Object(l["a"])(d,a,n,!1,null,null,null);t["default"]=$.exports;h()($,{VBtn:f["a"],VCol:g["a"],VContainer:p["a"],VProgressCircular:v["a"],VRow:m["a"],VSnackbar:b["a"],VSpacer:w["a"],VTextField:k["a"]})},cf1c:function(e,t,o){e.exports=o.p+"img/loading.gif"}}]);