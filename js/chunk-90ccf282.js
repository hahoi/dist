(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-90ccf282"],{"0b06":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tree"},[s("v-container",[s("v-row",[s("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"12",md:"6"}},[s("v-text-field",{attrs:{label:"關鍵字搜尋..."},model:{value:t.searchword,callback:function(e){t.searchword=e},expression:"searchword"}})],1),s("v-col",{staticClass:"py-0",attrs:{cols:"3",sm:"3",md:"2"}},[s("v-btn",{attrs:{color:"info"},on:{click:t.searchFun}},[t._v("搜尋")])],1),s("v-col",{staticClass:"py-0 pl-0 pr-5",attrs:{cols:"3",sm:"3",md:"2"}},[s("v-btn",{attrs:{color:"blue lighten-4"},on:{click:t.restsearchFun}},[t._v("重置")])],1),s("v-col",{staticClass:"py-0",attrs:{cols:"6",sm:"6",md:"2"}},[s("v-btn",{attrs:{color:"orange"},on:{click:t.nearreported}},[t._v("顯示近期填報")])],1)],1)],1),s("img",{directives:[{name:"show",rawName:"v-show",value:this.$store.state.loading,expression:"this.$store.state.loading"}],attrs:{src:a("cf1c"),height:"40px"}}),s("v-tree",{ref:"tree1",attrs:{data:t.treeData,tpl:t.tpl}}),s("v-container",[s("v-row",[s("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.workDetailDialog,callback:function(e){t.workDetailDialog=e},expression:"workDetailDialog"}},[s("v-toolbar",{attrs:{dark:"",color:"primary"}},[s("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:function(e){t.workDetailDialog=!1}}},[s("v-icon",[t._v("mdi-backspace")]),s("span",{staticClass:"title"},[t._v("退回")])],1),s("v-spacer")],1),s("v-card",{staticClass:"mx-auto",attrs:{tile:""}},[s("v-card-text",{staticClass:"px-3"},[s("workdetail",{attrs:{propData:t.todo},on:{listenToChild:t.getChildData}})],1)],1)],1)],1)],1),s("v-snackbar",{attrs:{timeout:t.timeout},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.databasemessage)+" "),s("v-btn",{attrs:{dark:"",text:""},on:{click:function(e){t.snackbar=!1}}},[t._v("Close")])],1)],1)},r=[],o=(a("a4d3"),a("99af"),a("4de4"),a("c975"),a("d81d"),a("4e827"),a("b0c0"),a("e439"),a("dbb4"),a("b64b"),a("4d63"),a("25f0"),a("466d"),a("5319"),a("1276"),a("498a"),a("159b"),a("ade3")),i=a("9138"),n=a("6fa2"),c=a("c1df"),l=a.n(c),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-card",{staticClass:"mx-auto blue lighten-5",attrs:{"max-width":"550",align:"left",outlined:""}},[a("v-card-text",[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{cols:"12"}},[a("div",{staticClass:"subtitle-1 mb-1",domProps:{innerHTML:t._s(t.propData.ptitle)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 開始日期： "),a("span",{staticClass:"body-1 blue--text",domProps:{innerHTML:t._s(t.propData.t_startdate)}})]),a("v-col",{staticClass:"mb-2",attrs:{cols:"12"}},[t._v(" 完成日期： "),a("span",{staticClass:"body-1 blue--text mb-1",domProps:{innerHTML:t._s(t.propData.t_enddate)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 負責單位： "),a("span",{staticClass:"body-1",domProps:{innerHTML:t._s(t.propData.depart)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 剩餘天數： "),a("span",{staticClass:"body-1 blue--text",domProps:{innerHTML:t._s(t.propData.remaindays)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 狀態： "),a("span",{staticClass:"body-1",domProps:{innerHTML:t._s(t.propData.status)}})]),a("v-col",{attrs:{cols:"12"}},[a("span",{staticClass:"body-2",domProps:{innerHTML:t._s(t.propData.memo)}})])],1)],1),a("v-card-actions",[a("v-btn",{attrs:{text:"",color:"orange"},on:{click:t.workItemDetailEdit}},[t._v("編輯")]),a("v-spacer"),a("v-btn",{attrs:{text:"",color:"indigo"},on:{click:function(e){return t.ProcessAdd(t.newProcess,t.propData.id,!0,-1)}}},[t._v("進度填報")])],1)],1),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.detailEditDialog,callback:function(e){t.detailEditDialog=e},expression:"detailEditDialog"}},[a("workdetailEdit",{attrs:{propData2:t.editWorkItemDetailData},on:{listenToChild2:t.getChildData_ItemDetailEdit}})],1),a("v-card",{staticClass:"mx-auto lighten-5",staticStyle:{"border-width":"0px"},attrs:{"max-width":"550",align:"left",outlined:"",tile:""}},[a("v-card-text",{staticClass:"px-0"},[a("div",[a("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[t._v("填報日期")]),a("th",{staticClass:"text-left"},[t._v("進度說明")]),a("th",{staticClass:"text-left"},[t._v("佐證資料")])])]),a("tbody",t._l(t.propData.process,(function(e,s){return a("tr",[a("td",{staticClass:"text-left px-0"},[a("v-menu",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(s){var r=s.on;return[a("v-btn",t._g({staticClass:"text-left px-0",attrs:{text:""}},r),[t._v(t._s(e.t_pgdate))])]}}],null,!0)},[a("v-list",[a("v-list-item",[a("v-list-item-title",{on:{click:function(a){return t.ProcessAdd(e,t.propData.id,!1,s)}}},[t._v("修改")])],1),a("v-list-item",[a("v-list-item-title",{on:{click:function(a){return t.ProcessDelete(e,t.propData.id,s)}}},[t._v("刪除")])],1)],1)],1)],1),a("td",{staticClass:"text-left"},[t._v(t._s(e.pgdesc))]),e.pdf?a("td",{staticClass:"text-center"},[a("span",{staticClass:"blue--text",on:{click:function(a){return t.openPDF(""+e.cfmpic)}}},[t._v("檢視")])]):a("td",{directives:[{name:"viewer",rawName:"v-viewer",value:{inline:!1,button:!0,navbar:!1,title:!0,toolbar:!1,tooltip:!1,movable:!1,zoomable:!0,rotatable:!1,scalable:!1,transition:!1,fullscreen:!0,keyboard:!0,url:"data-source"},expression:"{'inline': false, 'button': true, 'navbar': false, 'title': true, 'toolbar': false, 'tooltip': false, 'movable': false, 'zoomable': true, 'rotatable': false, 'scalable': false, 'transition': false, 'fullscreen': true, 'keyboard': true, 'url': 'data-source' }"}],domProps:{innerHTML:t._s("<img src='"+e.cfmpic+"' style='height:80px;width:80px'>")}})])})),0)]},proxy:!0}])})],1)]),a("v-card-actions")],1),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.ProcessAddDialog,callback:function(e){t.ProcessAddDialog=e},expression:"ProcessAddDialog"}},[a("workProcessAdd",{attrs:{propData4:t.ProcessAddData,addProcess:t.addProcess,ProcessNodeId:t.ProcessNodeId,ProcessItemIndex:t.ProcessItemIndex,ifProgressReport:!1},on:{listenToChild4:t.getChildData_ProcessAdd}})],1),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.PDFdialog,callback:function(e){t.PDFdialog=e},expression:"PDFdialog"}},[a("v-card",[a("v-toolbar",{attrs:{dark:"",color:"primary"}},[a("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:function(e){t.PDFdialog=!1}}},[a("v-icon",[t._v("mdi-backspace")]),a("span",{staticClass:"title"},[t._v("關閉")])],1)],1),a("v-card-text",{staticClass:"px-0"},[a("iframe",{ref:"PDFiframe",attrs:{id:"PDFiframe",src:t.PDFURL,width:"100%",height:"1500px",frameborder:"0"}})])],1)],1)],1)},p=[],u=(a("a434"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"grey lighten-2"},[a("v-toolbar",{attrs:{dark:"",color:"orange"}},[a("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:t.recordClose}},[a("v-icon",[t._v("mdi-backspace")]),a("span",{staticClass:"title"},[t._v("退回")])],1),a("v-spacer"),a("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:t.recordSave}},[a("v-icon",[t._v("mdi-content-save-outline")]),a("span",{staticClass:"title"},[t._v("儲存")])],1)],1),a("v-card",{staticClass:"mx-auto",attrs:{height:"100vh","max-width":"550"}},[a("v-card-title",{staticClass:"pb-0"},[t._v("基本資料編輯")]),a("v-card-text",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[a("v-container",{staticClass:"text-center"},[a("div",{staticClass:"text-center mb-4"},[a("v-overlay",{attrs:{opacity:.5,"z-index":"1",value:t.alert}},[a("v-alert",{attrs:{color:"red",dark:"",transition:"scale-transition"}},[t._v(t._s(t.alertResult))])],1)],1),a("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[a("v-dialog",{ref:"startDateDialog",attrs:{"return-value":t.propData2.t_startdate,persistent:"",width:"290px"},on:{"update:returnValue":function(e){return t.$set(t.propData2,"t_startdate",e)},"update:return-value":function(e){return t.$set(t.propData2,"t_startdate",e)}},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[a("v-text-field",t._g({attrs:{label:"開始日期",rules:[t.rules.required],readonly:""},model:{value:t.propData2.t_startdate,callback:function(e){t.$set(t.propData2,"t_startdate",e)},expression:"propData2.t_startdate"}},s))]}}]),model:{value:t.startDateDialogModal,callback:function(e){t.startDateDialogModal=e},expression:"startDateDialogModal"}},[a("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData2.t_startdate,callback:function(e){t.$set(t.propData2,"t_startdate",e)},expression:"propData2.t_startdate"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.startDateDialogModal=!1}}},[t._v("Cancel")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.startDateDialog.save(t.propData2.t_startdate)}}},[t._v("OK")])],1)],1)],1),a("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[a("v-dialog",{ref:"endDateDialog",attrs:{"return-value":t.propData2.t_enddate,persistent:"",width:"290px"},on:{"update:returnValue":function(e){return t.$set(t.propData2,"t_enddate",e)},"update:return-value":function(e){return t.$set(t.propData2,"t_enddate",e)}},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[a("v-text-field",t._g({attrs:{label:"結束日期",rules:[t.rules.required],readonly:""},model:{value:t.propData2.t_enddate,callback:function(e){t.$set(t.propData2,"t_enddate",e)},expression:"propData2.t_enddate"}},s))]}}]),model:{value:t.endDateDialogModal,callback:function(e){t.endDateDialogModal=e},expression:"endDateDialogModal"}},[a("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData2.t_enddate,callback:function(e){t.$set(t.propData2,"t_enddate",e)},expression:"propData2.t_enddate"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.endDateDialogModal=!1}}},[t._v("Cancel")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.endDateDialog.save(t.propData2.t_enddate)}}},[t._v("OK")])],1)],1)],1),a("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[a("v-select",{attrs:{items:t.depart,label:"負責單位"},model:{value:t.propData2.depart,callback:function(e){t.$set(t.propData2,"depart",e)},expression:"propData2.depart"}})],1),a("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[a("v-select",{attrs:{label:"狀態",items:t.status,rules:[t.rules.required]},model:{value:t.propData2.status,callback:function(e){t.$set(t.propData2,"status",e)},expression:"propData2.status"}})],1),a("v-col",{staticClass:"py-1",attrs:{cols:"12"}},[a("v-textarea",{attrs:{"auto-grow":"",color:"deep-purple",label:"備註",rows:"1",rules:[t.rules.length(50)]},model:{value:t.propData2.memo,callback:function(e){t.$set(t.propData2,"memo",e)},expression:"propData2.memo"}})],1)],1)],1)],1)],1)],1)}),f=[],h={name:"workdetailEdit",props:["propData2"],data:function(){return{alertResult:"",alert:!1,valid:!1,rules:{email:function(t){return(t||"").match(/@/)||"Please enter a valid email"},length:function(t){return function(e){return(e||"").length<=t||"最多".concat(t,"個字元")}},password:function(t){return(t||"").match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*(_|[^\w])).+$/)||"Password must contain an upper case letter, a numeric character, and a special character"},required:function(t){return!!t||"這個欄位必須要輸入"}},startDateDialogModal:!1,endDateDialogModal:!1,depart:[],status:[]}},components:{},created:function(){var t=this;i["d"].collection("SettingData").doc("Department").get().then((function(e){var a=e.data().depart;a.sort((function(t,e){return t.order-e.order})).forEach((function(e){t.depart.push(e.title)}))})),i["d"].collection("SettingData").doc("WorkItemStatus").get().then((function(e){t.status=e.data().status}))},mounted:function(){},watch:{},computed:{},methods:{recordClose:function(){this.$emit("listenToChild2",!1)},recordSave:function(){return l()(this.propData2.t_enddate).isAfter(this.propData2.parentEndDate)?(this.ShowAlert("結束日期 ＞ 專案結束日期！(".concat(this.propData2.parentEndDate,")")),!1):l()(this.propData2.t_startdate).isAfter(this.propData2.t_enddate)?(this.ShowAlert("開始日期 ＞ 結束日期！"),!1):this.$refs.form.validate()?void this.$emit("listenToChild2",this.propData2):(this.ShowAlert("輸入資料有錯誤！"),!1)},ShowAlert:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.alertResult=t,this.alert=!0,setTimeout((function(){e.alertResult="",e.alert=!1}),a)}}},v=h,m=a("2877"),g=a("6544"),D=a.n(g),_=a("0798"),b=a("8336"),x=a("b0af"),y=a("99d9"),k=a("62ad"),w=a("a523"),P=a("2e4b"),C=a("169a"),V=a("4bd4"),I=a("132d"),S=a("a797"),E=a("b974"),T=a("2fa4"),F=a("8654"),$=a("a844"),M=a("71d9"),R=Object(m["a"])(v,u,f,!1,null,null,null),O=R.exports;D()(R,{VAlert:_["a"],VBtn:b["a"],VCard:x["a"],VCardText:y["d"],VCardTitle:y["e"],VCol:k["a"],VContainer:w["a"],VDatePicker:P["a"],VDialog:C["a"],VForm:V["a"],VIcon:I["a"],VOverlay:S["a"],VSelect:E["a"],VSpacer:T["a"],VTextField:F["a"],VTextarea:$["a"],VToolbar:M["a"]});var A=a("b4ce"),L={name:"workdetail",props:["propData"],data:function(){return{detailEditDialog:!1,editWorkItemDetailData:{},tempDetailData:{},ProcessAddDialog:!1,ProcessAddData:{},tempProcessAddData:{},tempIndex:-1,addProcess:!0,ProcessNodeId:"",ProcessItemIndex:-1,newProcess:{cfmpic:"",pgdate:new Date(l()()),pgdesc:"",pickey:"",t_pgdate:l()().format("YYYY-MM-DD")},PDFdialog:!1,PDFURL:"",iframeHeight:"1000 px"}},components:{workdetailEdit:O,workProcessAdd:A["a"]},created:function(){},mounted:function(){},watch:{},computed:{},methods:{workItemDetailEdit:function(){this.detailEditDialog=!0,this.editWorkItemDetailData=this.propData,this.tempDetailData=Object.assign({},this.propData)},getChildData_ItemDetailEdit:function(t){if(this.detailEditDialog=!1,!t)return this.propData.title=this.tempDetailData.t_title,this.propData.depart=this.tempDetailData.depart,this.propData.t_enddate=this.tempDetailData.t_enddate,this.propData.t_startdate=this.tempDetailData.t_startdate,this.propData.status=this.tempDetailData.status,this.propData.process=this.tempDetailData.process,this.propData.memo=this.tempDetailData.memo,!1;this.propData.title=this.propData.t_title,this.propData.depart=t.depart,this.propData.t_enddate=t.t_enddate,this.propData.t_startdate=t.t_startdate,this.propData.status=t.status,this.propData.process=t.process,t.memo&&(this.propData.memo=t.memo);var e="";l()(this.propData.t_startdate)<l()()&&"完成"!=this.propData.status?(this.propData.remaindays=l()(l()(this.propData.t_enddate).diff(l()())).format("D"),e=l()(this.propData.t_enddate).diff(l()(),"day"),this.propData.remaindays='<span class="red--text">'.concat(e,"天</span>")):this.propData.remaindays="",console.log("save",this.propData),this.$emit("listenToChild",t),this.dialog=!1},ProcessAdd:function(t,e,a,s){this.addProcess=a,this.ProcessNodeId=e,this.ProcessItemIndex=s,a?this.ProcessAddData=Object.assign({},t):(this.tempProcessAddData=Object.assign({},t),this.tempIndex=s,this.ProcessAddData=t),this.ProcessAddDialog=!0},getChildData_ProcessAdd:function(t,e,a,s){if(this.ProcessAddDialog=!1,!t)return a||Object.assign(this.propData.process[this.tempIndex],this.tempProcessAddData),!1;t.pgdate=new Date(l()(t.t_pgdate)),a?this.propData.process.unshift(t):(Object.assign(this.propData.process[s],t),this.$forceUpdate());var r={process:this.propData.process};console.log("updateData",r),i["d"].collection(i["a"]).doc(e).update(r).then((function(){console.log("Document successfully Update!")})).catch((function(t){console.log("Uh-oh, an error occurred!")}))},ProcessDelete:function(t,e,a){var s=this;return console.log(this.propData,t,e,a),this.$dialog["warning"]({title:"警告",text:"確定要刪除這個進度嗎？",persistent:!1}).then((function(r){if(r){var o={process:s.propData.process};o.process.splice(a,1),i["d"].collection(i["a"]).doc(e).update(o).then((function(){console.log("Document successfully Update!")})).catch((function(t){console.log("Uh-oh, an error occurred!")})),console.log(t.pickey),""!=t.pickey&&i["f"].ref().child(t.pickey).delete()}})),this.ProcessAddDialog=!0,!1},openPDF:function(t){this.setiframe("PDFiframe"),this.PDFURL=t,this.PDFdialog=!0},setiframe:function(t){var e=this.$refs.PDFiframe,a=Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight);e&&(e.height=a+"px")}}},j=L,Y=a("8860"),N=a("da13"),U=a("5d23"),H=a("e449"),z=a("0fd9"),G=a("1f4f"),B=Object(m["a"])(j,d,p,!1,null,null,null),q=B.exports;function W(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function X(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?W(Object(a),!0).forEach((function(e){Object(o["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):W(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}D()(B,{VBtn:b["a"],VCard:x["a"],VCardActions:y["b"],VCardText:y["d"],VCol:k["a"],VDialog:C["a"],VIcon:I["a"],VList:Y["a"],VListItem:N["a"],VListItemTitle:U["k"],VMenu:H["a"],VRow:z["a"],VSimpleTable:G["a"],VSpacer:T["a"],VToolbar:M["a"]});var J={name:"worklist",data:function(){return{workDetailDialog:!1,searchword:"",treeData:[],db_data:[],todo:{},ShowRecentReport:10,snackbar:!1,timeout:2e3,databasemessage:""}},components:{workdetail:q},created:function(){var t=this;this.$store.commit("setLoading",!0),i["d"].collection(i["a"]).onSnapshot((function(e){var a=e.docChanges();a.forEach((function(e){"added"!==e.type||t.$store.state.loading||(t.databasemessage=t.$store.getters.user.name+" 正在新增資料！",t.snackbar=!0),"modified"===e.type&&(t.databasemessage=t.$store.getters.user.name+" 已經修改資料！",t.snackbar=!0),"removed"===e.type&&(t.databasemessage=t.$store.getters.user.name+" 已經刪除資料！",t.snackbar=!0)}))}))},mounted:function(){this.readData()},watch:{},computed:{},methods:{nearreported:function(){var t=this;this.$dialog.prompt({text:"天數",title:"顯示幾天內填報的資料：",persistent:!1}).then((function(e){e&&(t.ShowRecentReport=e,t.handleData(t.db_data))}))},readData:function(){var t=this;this.db_data=[],i["d"].collection(i["a"]).get().then((function(e){e.forEach((function(e){t.db_data.push(e.data())}))})).then((function(){t.handleData(t.db_data)}))},handleData:function(t){var e=this,a=t.map((function(t){return e.handleNodeData(t)}));this.treeData=n["a"].arrayToJson(a),this.$store.commit("setLoading",!1)},handleNodeData:function(t){t.t_title?t.title=t.t_title:t.t_title=t.title,t.enddate&&(t.t_enddate=l()(t.enddate.toDate()).format("YYYY-MM-DD")),t.startdate&&(t.t_startdate=l()(t.startdate.toDate()).format("YYYY-MM-DD")),t.process&&(t.process.forEach((function(t){t.t_pgdate=l()(t.pgdate.toDate()).format("YYYY-MM-DD")||""})),t.process.sort((function(t,e){return l()(e.t_pgdate).diff(l()(t.t_pgdate))})));var e="";return l()(t.t_startdate)<l()()&&"完成"!=t.status?(t.remaindays=l()(l()(t.t_enddate).diff(l()())).format("D"),e=l()(t.t_enddate).diff(l()(),"day"),t.remaindays='<span class="red--text">'.concat(e,"天</span>")):t.remaindays="","完成"==t.status&&(t.title="<span class='green--text'>"+t.title+"</span>"),"不顯示"==t.status||"停止"==t.status?{}:(e<=0&&""!==e&&(t.title="<span class='red--text'>"+t.title+"</span>"),(l()().isBefore(t.t_startdate)||""==t.t_startdate)&&(t.title="<span class='grey--text'>"+t.title+"</span>"),t.ptitle=t.title,t.process&&t.process.length>0&&(0==this.ShowRecentReport?t.title=t.title:l()().diff(l()(t.process[0].t_pgdate),"day")<=this.ShowRecentReport&&(t.title="".concat(t.title,"-").concat(t.depart,' 【<span class="blue--text">').concat(t.process[0].t_pgdate," - ").concat(t.process[0].pgdesc,"</span>】"))),t)},restsearchFun:function(){return this.searchword="",this.readData(),!0},searchFun:function(){var t=this;if(""===this.searchword)return this.readData(),!0;this.searchword=this.searchword.trim();var e=this.searchword.split(/\s+/),a=["title","depart","status"],s=this.$refs.tree1.getNodes(),r=s.filter((function(t){var s=!0,r=[],o=e.length;while(o--)r[o]=!1;return a.forEach((function(a){if(!t[a])return!1;e.forEach((function(e,s){var o=t[a].indexOf(e);-1!=o&&(r[s]=!0)}))})),r.forEach((function(t){0==t&&(s=!1)})),s})).map((function(s){if(""==t.searchword)return s;var r=JSON.parse(JSON.stringify(s));return a.forEach((function(t){e.forEach((function(e){if("undefined"===typeof r[t])return!1;var a=new RegExp(e,"i"),s=r[t].match(a);s&&(r[t]=r[t].replace(a,"<span class='red white--text'>"+s[0]+"</span>"))}))})),r.expanded=!0,r}));this.treeData=n["a"].arrayToTree(r)},tpl:function(){for(var t=this,e=this.$createElement,a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];var o=s[0],i=s[1],n=s[2],c=(s[3],o.selected?"node-title node-selected":"node-title");return o.searched&&(c+=" node-searched"),e("span",[e("span",{class:c,domProps:{innerHTML:o.title},on:{click:function(){var e;i.parent.nodeSelected(i.props.node),e=null===n?t.$store.getters.projectEndDate:n.t_enddate||t.$store.getters.projectEndDate,t.todo=X({parentEndDate:e},o),t.workDetailDialog=!0}}})])},getChildData:function(t){var e=this,a=this.$refs.tree1.getNodes();a.forEach((function(a){if(a.id===t.id){a.title=a.t_title,a.depart=t.depart,a.t_enddate=t.t_enddate,a.t_startdate=t.t_startdate,a.status=t.status,a.process=t.process,t.memo&&(a.memo=t.memo),a.process&&a.process.sort((function(t,e){return l()(e.t_pgdate).diff(l()(t.t_pgdate))}));var s="";if(l()(a.t_startdate)<l()()&&"完成"!=a.status?(s=l()(a.t_enddate).diff(l()(),"day"),a.remaindays='<span class="red--text">'.concat(s,"天</span>")):a.remaindays="","完成"==a.status&&(a.title="<span class='green--text'>"+a.title+"</span>"),"不顯示"==a.status||"停止"==a.status)return{};s<=0&&""!==s&&(a.title="<span class='red--text'>"+a.title+"</span>"),(l()().isBefore(a.t_startdate)||""==a.t_startdate)&&(a.title="<span class='grey--text'>"+a.title+"</span>"),a.ptitle=a.title,a.process&&a.process.length>0&&(0==e.ShowRecentReport?a.title=a.title:l()().diff(l()(a.process[0].t_pgdate),"day")<=e.ShowRecentReport&&(a.title="".concat(a.title,"-").concat(a.depart,' 【<span class="blue--text">').concat(a.process[0].t_pgdate," - ").concat(a.process[0].pgdesc,"</span>】")))}})),this.treeData=n["a"].arrayToJson(a);var s={depart:t.depart,enddate:new Date(l()(t.t_enddate)),startdate:new Date(l()(t.t_startdate)),status:t.status,process:t.process||[]};t.memo&&(s.memo=t.memo),i["d"].collection(i["a"]).doc(t.id).update(s).then((function(){console.log("Document successfully Update!")}))},getServerTime:function(){var t=i["c"].ref(".info/serverTimeOffset");t.on("value",(function(t){var e=t.val(),a=(new Date).getTime()+e;return console.log(l()().format("YYYY-MM-DD hh:ss")),console.log(l()(a).format("YYYY-MM-DD hh:ss")),a}))}}},K=J,Z=a("2db4"),Q=Object(m["a"])(K,s,r,!1,null,null,null);e["default"]=Q.exports;D()(Q,{VBtn:b["a"],VCard:x["a"],VCardText:y["d"],VCol:k["a"],VContainer:w["a"],VDialog:C["a"],VIcon:I["a"],VRow:z["a"],VSnackbar:Z["a"],VSpacer:T["a"],VTextField:F["a"],VToolbar:M["a"]})},"4d63":function(t,e,a){var s=a("83ab"),r=a("da84"),o=a("94ca"),i=a("7156"),n=a("9bf2").f,c=a("241c").f,l=a("44e7"),d=a("ad6d"),p=a("9f7f"),u=a("6eeb"),f=a("d039"),h=a("69f3").set,v=a("2626"),m=a("b622"),g=m("match"),D=r.RegExp,_=D.prototype,b=/a/g,x=/a/g,y=new D(b)!==b,k=p.UNSUPPORTED_Y,w=s&&o("RegExp",!y||k||f((function(){return x[g]=!1,D(b)!=b||D(x)==x||"/a/i"!=D(b,"i")})));if(w){var P=function(t,e){var a,s=this instanceof P,r=l(t),o=void 0===e;if(!s&&r&&t.constructor===P&&o)return t;y?r&&!o&&(t=t.source):t instanceof P&&(o&&(e=d.call(t)),t=t.source),k&&(a=!!e&&e.indexOf("y")>-1,a&&(e=e.replace(/y/g,"")));var n=i(y?new D(t,e):D(t,e),s?this:_,P);return k&&a&&h(n,{sticky:a}),n},C=function(t){t in P||n(P,t,{configurable:!0,get:function(){return D[t]},set:function(e){D[t]=e}})},V=c(D),I=0;while(V.length>I)C(V[I++]);_.constructor=P,P.prototype=_,u(r,"RegExp",P)}v("RegExp")},b4ce:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"grey lighten-2"},[a("v-toolbar",{attrs:{dark:"",color:"indigo"}},[a("v-btn",{staticClass:"py-0 pl-1",attrs:{dark:"",text:""},on:{click:t.ProcessClose}},[a("v-icon",[t._v("mdi-backspace")]),a("span",{staticClass:"title"},[t._v("退回")])],1),a("v-spacer"),a("span",{staticClass:"headline lime--text"},[t._v(t._s(t.addProcess?"新增":"修改"))]),a("v-spacer")],1),a("v-card",{staticClass:"mx-auto",attrs:{height:"100vh","max-width":"550"}},[a("v-card-text",{staticClass:"py-0"},[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[a("v-container",{staticClass:"text-center pb-0"},[a("div",{staticClass:"text-center mb-4"},[a("v-overlay",{attrs:{opacity:.5,"z-index":"1",value:t.alert}},[a("v-alert",{attrs:{color:"red",dark:"",transition:"scale-transition"}},[t._v(t._s(t.alertResult))])],1)],1),t.ifProgressReport?a("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[a("v-text-field",{attrs:{label:"填報日期",rules:[t.rules.required],readonly:""},model:{value:t.propData4.t_pgdate,callback:function(e){t.$set(t.propData4,"t_pgdate",e)},expression:"propData4.t_pgdate"}})],1):a("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[a("v-dialog",{ref:"startDateDialog",attrs:{"return-value":t.propData4.t_pgdate,persistent:"",width:"290px"},on:{"update:returnValue":function(e){return t.$set(t.propData4,"t_pgdate",e)},"update:return-value":function(e){return t.$set(t.propData4,"t_pgdate",e)}},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on;return[a("v-text-field",t._g({attrs:{label:"填報日期",rules:[t.rules.required],readonly:""},model:{value:t.propData4.t_pgdate,callback:function(e){t.$set(t.propData4,"t_pgdate",e)},expression:"propData4.t_pgdate"}},s))]}}]),model:{value:t.startDateDialogModal,callback:function(e){t.startDateDialogModal=e},expression:"startDateDialogModal"}},[a("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData4.t_pgdate,callback:function(e){t.$set(t.propData4,"t_pgdate",e)},expression:"propData4.t_pgdate"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.startDateDialogModal=!1}}},[t._v("Cancel")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.startDateDialog.save(t.propData4.t_pgdate)}}},[t._v("OK")])],1)],1)],1),a("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[a("v-text-field",{attrs:{label:"進度說明",rules:[t.rules.required,t.rules.length(32)],counter:32},model:{value:t.propData4.pgdesc,callback:function(e){t.$set(t.propData4,"pgdesc",e)},expression:"propData4.pgdesc"}})],1),a("v-col",{staticClass:"pa-0",attrs:{cols:"12",align:"right"}},[""!==t.propData4.cfmpic&&3!==t.e1?a("v-btn",{attrs:{text:"",color:"orange"},on:{click:t.ProcessSave}},[t._v("進度說明存檔")]):t._e()],1)],1)],1)],1),[a("v-stepper",{attrs:{vertical:""},model:{value:t.e1,callback:function(e){t.e1=e},expression:"e1"}},[a("v-stepper-header",[a("v-stepper-step",{attrs:{complete:t.e1>1,step:"1"}},[t._v("步驟1")]),a("v-divider"),a("v-stepper-step",{attrs:{complete:t.e1>2,step:"2"}},[t._v("步驟2")]),a("v-divider"),a("v-stepper-step",{attrs:{step:"3"}},[t._v("步驟3")])],1),a("v-stepper-items",[a("v-stepper-content",{attrs:{step:"1"}},[a("v-card",{staticClass:"mb-2",attrs:{color:"grey lighten-2",height:"150",align:"center",justify:"center"}},[a("v-card-text",[""==t.propData4.cfmpic||t.propData4.pdf?t._e():a("div",{staticClass:"flex"},[a("v-img",{attrs:{src:t.propData4.cfmpic,"max-width":"100"}})],1),t.propData4.pdf?a("div",[t._v("PDF")]):t._e(),a("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{id:"inputimage",type:"file",accept:"image/*, .pdf"},on:{change:t.handleFileSelect}})])],1),a("v-btn",{attrs:{color:"primary"},on:{click:function(e){return t.$refs.fileInput.click()}}},[t._v("佐證資料")])],1),a("v-stepper-content",{attrs:{step:"2"}},[a("v-card",{staticClass:"mb-2",attrs:{color:"grey lighten-2",height:"150",align:"center",justify:"center"}},[a("v-card-text",{staticClass:"py-0"},[a("v-row",{staticClass:"pa-0"},[a("v-col",{staticClass:"pa-0",attrs:{cols:"8"}},t._l(t.imageFiles,(function(e,s){return a("div",[a("span",{staticClass:"delbtn",on:{click:function(e){return t.delImage(s)}}},[a("v-icon",{attrs:{large:"",color:""}},[t._v("mdi-delete-forever")])],1),t._v(" "+t._s(e.filename)+" "),a("br"),a("div",[a("v-img",{attrs:{src:e.imageDataUrl,"max-width":"100"}}),a("br"),e.GPSLatitude?a("div",[t._v(" 緯度："+t._s(e.GPSLatitude)+" "),a("br"),t._v(" 經度："+t._s(e.GPSLongitude)+" ")]):t._e()],1)])})),0),a("v-col",{attrs:{cols:"4"}},[t.progress>0?a("span",{attrs:{id:"progress"}},[a("v-progress-circular",{attrs:{size:80,width:10,rotate:-90,value:t.progress,color:"primary"}},[t._v(t._s(t.progress))])],1):t._e()])],1)],1)],1),a("v-btn",{attrs:{color:"primary"},on:{click:function(e){return t.uploadImage()}}},[t._v("上傳圖檔")])],1),a("v-stepper-content",{attrs:{step:"3"}},[a("v-card",{staticClass:"mb-2",attrs:{color:"grey lighten-2",height:"150",align:"center",justify:"center"}},[a("v-card-text",[""==t.propData4.cfmpic||t.propData4.pdf?t._e():a("div",[a("v-img",{attrs:{src:t.propData4.cfmpic,"max-width":"100"}})],1),t.propData4.pdf?a("div",[t._v("PDF")]):t._e()])],1),a("v-btn",{attrs:{color:"orange"},on:{click:t.ProcessSave}},[t._v("完成並存檔")])],1)],1)],1)]],2)],1)},r=[],o=(a("7db0"),a("fb6a"),a("b0c0"),a("466d"),a("159b"),a("9138")),i=a("6fa2"),n=(a("c1df"),{name:"workProcessAdd",props:["propData4","ProcessNodeId","addProcess","ProcessItemIndex","ifProgressReport"],data:function(){return{alertResult:"",alert:!1,valid:!1,rules:{length:function(t){return function(e){return(e||"").length<=t||"最多".concat(t,"個字元")}},required:function(t){return!!t||"這個欄位必須要輸入"},size:function(t){return!t||t.size<2e6||"頭相照片尺寸小於 2 MB！，不清楚"}},startDateDialogModal:!1,imageFiles:[],progress:0,e1:1,steps:2}},components:{},created:function(){},mounted:function(){},watch:{},computed:{},methods:{ProcessSave:function(){if(!this.$refs.form.validate())return!1;this.imageFiles=[],this.progress=0,this.$emit("listenToChild4",this.propData4,this.ProcessNodeId,this.addProcess,this.ProcessItemIndex),this.e1=1},ProcessClose:function(){""!==this.propData4.pickey&&3===this.e1&&(console.log(this.propData4.pickey),o["f"].ref().child(this.propData4.pickey).delete().then((function(){console.log("File deleted successfully")})).catch((function(t){console.log("Uh-oh, an error occurred!")}))),this.imageFiles=[],this.progress=0,this.e1=1,this.$emit("listenToChild4",!1,this.ProcessNodeId,this.addProcess,this.ProcessItemIndex)},handleFileSelect:function(t){var e=this,a=null;if(t.target.files&&window.FileReader){var s=t.target.files,r=Array.prototype.slice.call(s),n=r[0];if("application/pdf"!=n.type)r.forEach((function(t,s){if(t.type.match("image.*")){e.imageFiles.unshift({filename:"",imageDataUrl:"",EXIF:{},discription:"",GPSLatitude:0,GPSLongitude:0});var r=new FileReader,o=new Image;EXIF.getData(t,(function(){a=EXIF.getTag(this,"Orientation");var t=EXIF.getTag(this,"GPSLatitudeRef"),r=EXIF.getTag(this,"GPSLatitude"),o=EXIF.getTag(this,"GPSLongitudeRef"),n=EXIF.getTag(this,"GPSLongitude");void 0!=t&&void 0!=o&&void 0!=n&&void 0!=n&&(e.imageFiles[s].GPSLatitude="N"==t?i["a"].change_latlng(r):-1*i["a"].change_latlng(r),e.imageFiles[s].GPSLongitude="E"==o?i["a"].change_latlng(n):-1*i["a"].change_latlng(n))})),r.onload=function(r){o.src=r.target.result,o.onload=function(){var r=this.width,o=this.height;r>o&&r>750?(r=750,o=Math.ceil(750*this.height/this.width)):r<o&&o>1334&&(r=Math.ceil(1334*this.width/this.height),o=1334);var i=document.createElement("canvas"),n=i.getContext("2d");if(i.width=r,i.height=o,a&&1!=a)switch(a){case 6:i.width=o,i.height=r,n.rotate(Math.PI/2),n.drawImage(this,0,-o,r,o);break;case 3:n.rotate(Math.PI),n.drawImage(this,-r,-o,r,o);break;case 8:i.width=o,i.height=r,n.rotate(3*Math.PI/2),n.drawImage(this,-r,0,r,o);break}else n.drawImage(this,0,0,r,o);e.imageFiles[s].imageDataUrl=i.toDataURL("image/jpeg",.8),e.imageFiles[s].filename="image.jpg"==t.name?Math.floor(Date.now()/1e3)+".jpg":Math.floor(Date.now()/1e3)+t.name}},r.readAsDataURL(t)}})),this.e1=2;else{var c=+new Date+"-"+n.name,l={contentType:n.type},d=o["f"].ref().child("/"+o["a"]+"/"+e.ProcessNodeId+"/"+c).put(n,l);d.on("state_changed",(function(t){e.progress=t.bytesTransferred/t.totalBytes*100}),(function(t){}),(function(){d.snapshot.ref.getDownloadURL().then((function(t){e.propData4.cfmpic=t,e.propData4.pickey="/"+o["a"]+"/"+e.ProcessNodeId+"/"+c,e.propData4.pdf=!0,e.e1=3}))}))}}},dellatlng:function(t){var e=confirm("刪除GPS資料？");if(e){var a=this,s=a.data1.find((function(t){return t.id==a.tid}));s.images[t].key;s.images[t].center.lat=0,s.images[t].center.lng=0,place_data.set(a.data1)}},delImage:function(t){this.imageFiles.shift(t),this.e1=1},removeImage:function(t){this.imageFiles=[]},uploadImage:function(){var t=this,e=t.imageFiles;e.forEach((function(e,a,s){var r=o["f"].ref().child("/"+o["a"]+"/"+t.ProcessNodeId+"/"+e.filename).putString(e.imageDataUrl,"data_url");r.on("state_changed",(function(e){t.progress=e.bytesTransferred/e.totalBytes*100}),(function(t){console.log(t),alert("上傳圖片有錯誤！")}),(function(){r.snapshot.ref.getDownloadURL().then((function(a){t.propData4.cfmpic=a,t.propData4.pickey="/"+o["a"]+"/"+t.ProcessNodeId+"/"+e.filename,console.log(t.propData4.pickey),t.imageFiles=[],t.e1=3,t.progress=0}))}))}))}}}),c=n,l=a("2877"),d=a("6544"),p=a.n(d),u=a("0798"),f=a("8336"),h=a("b0af"),v=a("99d9"),m=a("62ad"),g=a("a523"),D=a("2e4b"),_=a("169a"),b=a("ce7e"),x=a("4bd4"),y=a("132d"),k=a("adda"),w=a("a797"),P=a("490a"),C=a("0fd9"),V=a("2fa4"),I=a("7e85"),S=a("e516"),E=a("9c54"),T=a("56a4"),F=a("8654"),$=a("71d9"),M=Object(l["a"])(c,s,r,!1,null,"28996016",null);e["a"]=M.exports;p()(M,{VAlert:u["a"],VBtn:f["a"],VCard:h["a"],VCardText:v["d"],VCol:m["a"],VContainer:g["a"],VDatePicker:D["a"],VDialog:_["a"],VDivider:b["a"],VForm:x["a"],VIcon:y["a"],VImg:k["a"],VOverlay:w["a"],VProgressCircular:P["a"],VRow:C["a"],VSpacer:V["a"],VStepper:I["a"],VStepperContent:S["a"],VStepperHeader:E["c"],VStepperItems:E["d"],VStepperStep:T["a"],VTextField:F["a"],VToolbar:$["a"]})},cf1c:function(t,e,a){t.exports=a.p+"img/loading.gif"}}]);