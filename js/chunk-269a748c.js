(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-269a748c"],{"0b06":function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("div",{staticClass:"tree"},[r("v-container",[r("v-row",[r("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"12",md:"6"}},[r("v-text-field",{attrs:{label:"關鍵字搜尋..."},model:{value:t.searchword,callback:function(a){t.searchword=a},expression:"searchword"}})],1),r("v-col",{staticClass:"py-0",attrs:{cols:"6",sm:"6",md:"1"}},[r("v-btn",{attrs:{color:"info"},on:{click:t.searchFun}},[t._v("搜尋")])],1),r("v-col",{staticClass:"py-0",attrs:{cols:"6",sm:"6",md:"2"}},[r("v-btn",{attrs:{color:"orange"},on:{click:t.nearreported}},[t._v("顯示近期填報")])],1)],1)],1),r("img",{directives:[{name:"show",rawName:"v-show",value:this.$store.state.loading,expression:"this.$store.state.loading"}],attrs:{src:e("cf1c"),height:"40px"}}),r("v-tree",{ref:"tree1",attrs:{data:t.treeData,tpl:t.tpl}}),r("v-container",[r("v-row",[r("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.workDetailDialog,callback:function(a){t.workDetailDialog=a},expression:"workDetailDialog"}},[r("v-toolbar",{attrs:{dark:"",color:"primary"}},[r("v-btn",{staticClass:"mx-2",attrs:{icon:"",dark:"",text:""},on:{click:function(a){t.workDetailDialog=!1}}},[r("v-icon",[t._v("mdi-backspace")]),r("span",{staticClass:"title"},[t._v("退回")])],1),r("v-spacer")],1),r("v-card",{staticClass:"mx-auto",attrs:{tile:""}},[r("v-card-text",{staticClass:"px-3"},[r("workdetail",{attrs:{propData:t.todo},on:{listenToChild:t.getChildData}})],1)],1)],1)],1)],1),r("v-snackbar",{attrs:{timeout:t.timeout},model:{value:t.snackbar,callback:function(a){t.snackbar=a},expression:"snackbar"}},[t._v(" "+t._s(t.databasemessage)+" "),r("v-btn",{attrs:{dark:"",text:""},on:{click:function(a){t.snackbar=!1}}},[t._v("Close")])],1)],1)},s=[],o=(e("a4d3"),e("99af"),e("4de4"),e("d81d"),e("4e827"),e("b0c0"),e("e439"),e("dbb4"),e("b64b"),e("159b"),e("ade3")),n=e("9138"),i=e("6fa2"),l=e("c1df"),c=e.n(l),d=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("v-card",{staticClass:"mx-auto blue lighten-5",attrs:{"max-width":"550",align:"left",outlined:""}},[e("v-card-text",[e("v-row",{attrs:{"no-gutters":""}},[e("v-col",{attrs:{cols:"12"}},[e("div",{staticClass:"subtitle-1 mb-1",domProps:{innerHTML:t._s(t.propData.ptitle)}})]),e("v-col",{attrs:{cols:"12"}},[t._v(" 開始日期： "),e("span",{staticClass:"body-1 blue--text",domProps:{innerHTML:t._s(t.propData.t_startdate)}})]),e("v-col",{staticClass:"mb-2",attrs:{cols:"12"}},[t._v(" 完成日期： "),e("span",{staticClass:"body-1 blue--text mb-1",domProps:{innerHTML:t._s(t.propData.t_enddate)}})]),e("v-col",{attrs:{cols:"12"}},[t._v(" 負責單位： "),e("span",{staticClass:"body-1",domProps:{innerHTML:t._s(t.propData.depart)}})]),e("v-col",{attrs:{cols:"12"}},[t._v(" 剩餘天數： "),e("span",{staticClass:"body-1 blue--text",domProps:{innerHTML:t._s(t.propData.remaindays)}})]),e("v-col",{attrs:{cols:"12"}},[t._v(" 狀態： "),e("span",{staticClass:"body-1",domProps:{innerHTML:t._s(t.propData.status)}})]),e("v-col",{attrs:{cols:"12"}},[e("span",{staticClass:"body-2",domProps:{innerHTML:t._s(t.propData.memo)}})])],1)],1),e("v-card-actions",[e("v-btn",{attrs:{text:"",color:"orange"},on:{click:t.workItemDetailEdit}},[t._v("編輯")]),e("v-spacer"),e("v-btn",{attrs:{text:"",color:"indigo"},on:{click:function(t){}}},[t._v("進度填報")])],1)],1),e("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.detailEditDialog,callback:function(a){t.detailEditDialog=a},expression:"detailEditDialog"}},[e("workdetailEdit",{attrs:{propData2:t.editWorkItemDetailData},on:{listenToChild2:t.getChildData_ItemDetailEdit}})],1),e("v-card",{staticClass:"mx-auto lighten-5",staticStyle:{"border-width":"0px"},attrs:{"max-width":"550",align:"left",outlined:"",tile:""}},[e("v-card-text",{staticClass:"px-0"},[e("div",[e("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("填報日期")]),e("th",{staticClass:"text-left"},[t._v("進度說明")]),e("th",{staticClass:"text-left"},[t._v("佐證資料")])])]),e("tbody",t._l(t.propData.process,(function(a){return e("tr",{key:a.id},[e("td",{staticClass:"text-left px-0"},[e("v-menu",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(r){var s=r.on;return[e("v-btn",t._g({staticClass:"text-left px-0",attrs:{text:""}},s),[t._v(t._s(a.t_pgdate))])]}}],null,!0)},[e("v-list",[e("v-list-item",[e("v-list-item-title",[t._v("編輯")])],1),e("v-list-item",[e("v-list-item-title",[t._v("刪除")])],1)],1)],1)],1),e("td",{staticClass:"text-left"},[t._v(t._s(a.pgdesc))]),e("td",{domProps:{innerHTML:t._s("<img src='"+a.cfmpic+"' style='height:80px;width:80px'>")}})])})),0)]},proxy:!0}])})],1)]),e("v-card-actions")],1)],1)},p=[],u=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("v-toolbar",{attrs:{dark:"",color:"orange"}},[e("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:t.recordClose}},[e("v-icon",[t._v("mdi-backspace")]),e("span",{staticClass:"title"},[t._v("退回")])],1),e("v-spacer"),e("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:t.recordSave}},[e("v-icon",[t._v("mdi-content-save-outline")]),e("span",{staticClass:"title"},[t._v("儲存")])],1)],1),e("v-card",{attrs:{height:"100vh"}},[e("v-card-title",[t._v("基本資料編輯")]),e("v-card-text",[e("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(a){t.valid=a},expression:"valid"}},[e("v-container",{staticClass:"text-center"},[e("div",{staticClass:"text-center mb-4"},[e("v-overlay",{attrs:{opacity:.5,"z-index":"1",value:t.alert}},[e("v-alert",{attrs:{color:"red",dark:"",transition:"scale-transition"}},[t._v(t._s(t.alertResult))])],1)],1),e("v-col",{attrs:{cols:"12"}},[e("v-dialog",{ref:"startDateDialog",attrs:{"return-value":t.propData2.t_startdate,persistent:"",width:"290px"},on:{"update:returnValue":function(a){return t.$set(t.propData2,"t_startdate",a)},"update:return-value":function(a){return t.$set(t.propData2,"t_startdate",a)}},scopedSlots:t._u([{key:"activator",fn:function(a){var r=a.on;return[e("v-text-field",t._g({attrs:{label:"開始日期",rules:[t.rules.required],readonly:""},model:{value:t.propData2.t_startdate,callback:function(a){t.$set(t.propData2,"t_startdate",a)},expression:"propData2.t_startdate"}},r))]}}]),model:{value:t.startDateDialogModal,callback:function(a){t.startDateDialogModal=a},expression:"startDateDialogModal"}},[e("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData2.t_startdate,callback:function(a){t.$set(t.propData2,"t_startdate",a)},expression:"propData2.t_startdate"}},[e("v-spacer"),e("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(a){t.startDateDialogModal=!1}}},[t._v("Cancel")]),e("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(a){return t.$refs.startDateDialog.save(t.propData2.t_startdate)}}},[t._v("OK")])],1)],1)],1),e("v-col",{attrs:{cols:"12"}},[e("v-dialog",{ref:"endDateDialog",attrs:{"return-value":t.propData2.t_enddate,persistent:"",width:"290px"},on:{"update:returnValue":function(a){return t.$set(t.propData2,"t_enddate",a)},"update:return-value":function(a){return t.$set(t.propData2,"t_enddate",a)}},scopedSlots:t._u([{key:"activator",fn:function(a){var r=a.on;return[e("v-text-field",t._g({attrs:{label:"結束日期",rules:[t.rules.required],readonly:""},model:{value:t.propData2.t_enddate,callback:function(a){t.$set(t.propData2,"t_enddate",a)},expression:"propData2.t_enddate"}},r))]}}]),model:{value:t.endDateDialogModal,callback:function(a){t.endDateDialogModal=a},expression:"endDateDialogModal"}},[e("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData2.t_enddate,callback:function(a){t.$set(t.propData2,"t_enddate",a)},expression:"propData2.t_enddate"}},[e("v-spacer"),e("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(a){t.endDateDialogModal=!1}}},[t._v("Cancel")]),e("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(a){return t.$refs.endDateDialog.save(t.propData2.t_enddate)}}},[t._v("OK")])],1)],1)],1),e("v-col",{attrs:{cols:"12"}},[e("v-select",{attrs:{items:t.depart,label:"負責單位"},model:{value:t.propData2.depart,callback:function(a){t.$set(t.propData2,"depart",a)},expression:"propData2.depart"}})],1),e("v-col",{attrs:{cols:"12"}},[e("v-select",{attrs:{label:"狀態",items:t.status,rules:[t.rules.required]},model:{value:t.propData2.status,callback:function(a){t.$set(t.propData2,"status",a)},expression:"propData2.status"}})],1),e("v-col",{attrs:{cols:"12"}},[e("v-textarea",{attrs:{"auto-grow":"",color:"deep-purple",label:"備註",rows:"1",rules:[t.rules.length(50)]},model:{value:t.propData2.memo,callback:function(a){t.$set(t.propData2,"memo",a)},expression:"propData2.memo"}})],1)],1)],1)],1)],1)],1)},v=[],f=(e("466d"),{name:"workdetailEdit",props:["propData2"],data:function(){return{alertResult:"",alert:!1,valid:!1,rules:{email:function(t){return(t||"").match(/@/)||"Please enter a valid email"},length:function(t){return function(a){return(a||"").length<=t||"最多".concat(t,"個字元")}},password:function(t){return(t||"").match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*(_|[^\w])).+$/)||"Password must contain an upper case letter, a numeric character, and a special character"},required:function(t){return!!t||"這個欄位必須要輸入"}},startDateDialogModal:!1,endDateDialogModal:!1,depart:[],status:[]}},components:{},created:function(){var t=this;n["b"].collection("SettingData").doc("Department").get().then((function(a){var e=a.data().depart;e.sort((function(t,a){return t.order-a.order})).forEach((function(a){t.depart.push(a.title)}))})),n["b"].collection("SettingData").doc("WorkItemStatus").get().then((function(a){t.status=a.data().status}))},mounted:function(){},watch:{},computed:{},methods:{recordClose:function(){this.$emit("listenToChild2",!1)},recordSave:function(){return c()(this.propData2.t_startdate).isAfter(this.propData2.t_enddate)?(this.ShowAlert("開始日期 ＞ 結束日期！"),!1):this.$refs.form.validate()?(console.log("else",this.$refs.form.validate()),void this.$emit("listenToChild2",this.propData2)):(console.log(this.$refs.form.validate()),this.ShowAlert("輸入資料有錯誤！"),!1)},ShowAlert:function(t){var a=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.alertResult=t,this.alert=!0,setTimeout((function(){a.alertResult="",a.alert=!1}),e)}}}),m=f,D=e("2877"),h=e("6544"),_=e.n(h),g=e("0798"),b=e("8336"),x=e("b0af"),k=e("99d9"),y=e("62ad"),w=e("a523"),C=e("2e4b"),V=e("169a"),$=e("4bd4"),T=e("132d"),M=e("a797"),E=e("b974"),S=e("2fa4"),O=e("8654"),P=e("a844"),j=e("71d9"),L=Object(D["a"])(m,u,v,!1,null,null,null),I=L.exports;_()(L,{VAlert:g["a"],VBtn:b["a"],VCard:x["a"],VCardText:k["d"],VCardTitle:k["e"],VCol:y["a"],VContainer:w["a"],VDatePicker:C["a"],VDialog:V["a"],VForm:$["a"],VIcon:T["a"],VOverlay:M["a"],VSelect:E["a"],VSpacer:S["a"],VTextField:O["a"],VTextarea:P["a"],VToolbar:j["a"]});var R={name:"workdetail",props:["propData"],data:function(){return{detailEditDialog:!1,editWorkItemDetailData:{}}},components:{workdetailEdit:I},created:function(){},mounted:function(){},watch:{},computed:{},methods:{workItemDetailEdit:function(){this.detailEditDialog=!0,this.editWorkItemDetailData=i["a"].deepCopy(this.propData),console.log("editWorkItemDetailData",this.editWorkItemDetailData)},getChildData_ItemDetailEdit:function(t){if(this.detailEditDialog=!1,!t)return!1;this.propData.title=this.propData.t_title,this.propData.depart=t.depart,this.propData.t_enddate=t.t_enddate,this.propData.t_startdate=t.t_startdate,this.propData.status=t.status,this.propData.process=t.process,t.memo&&(this.propData.memo=t.memo);var a="";c()(this.propData.t_startdate)<c()()&&"完成"!=this.propData.status?(this.propData.remaindays=c()(c()(this.propData.t_enddate).diff(c()())).format("D"),a=c()(this.propData.t_enddate).diff(c()(),"day"),this.propData.remaindays='<span class="red--text">'.concat(a,"天</span>")):this.propData.remaindays="",this.$emit("listenToChild",t),this.dialog=!1}}},Y=R,H=e("8860"),A=e("da13"),B=e("5d23"),F=e("e449"),W=e("0fd9"),z=e("1f4f"),q=Object(D["a"])(Y,d,p,!1,null,null,null),J=q.exports;function N(t,a){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),e.push.apply(e,r)}return e}function K(t){for(var a=1;a<arguments.length;a++){var e=null!=arguments[a]?arguments[a]:{};a%2?N(Object(e),!0).forEach((function(a){Object(o["a"])(t,a,e[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):N(Object(e)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a))}))}return t}_()(q,{VBtn:b["a"],VCard:x["a"],VCardActions:k["b"],VCardText:k["d"],VCol:y["a"],VDialog:V["a"],VList:H["a"],VListItem:A["a"],VListItemTitle:B["k"],VMenu:F["a"],VRow:W["a"],VSimpleTable:z["a"],VSpacer:S["a"]});var U={name:"worklist",data:function(){return{workDetailDialog:!1,searchword:"",treeData:[],db_data:[],todo:{},ShowRecentReport:10,snackbar:!1,timeout:2e3,databasemessage:""}},components:{workdetail:J},created:function(){var t=this;this.$store.commit("setLoading",!0),n["b"].collection("TLFMCD").onSnapshot((function(a){var e=a.docChanges();e.forEach((function(a){"added"!==a.type||t.$store.state.loading||(t.databasemessage=t.$store.getters.user.name+" 正在新增資料！",t.snackbar=!0),"modified"===a.type&&(t.databasemessage=t.$store.getters.user.name+" 已經修改資料！",t.snackbar=!0),"removed"===a.type&&(t.databasemessage=t.$store.getters.user.name+" 已經刪除資料！",t.snackbar=!0)}))}))},mounted:function(){this.readData()},watch:{},computed:{},methods:{nearreported:function(){var t=this;this.$dialog.prompt({text:"天數",title:"請輸入幾天內填報才顯示："}).then((function(a){t.ShowRecentReport=a,t.handleData(t.db_data)}))},readData:function(){var t=this;n["b"].collection("TLFMCD").get().then((function(a){a.forEach((function(a){t.db_data.push(a.data())})),t.handleData(t.db_data)}))},handleData:function(t){var a=this,e=t.map((function(t){t.t_title?t.title=t.t_title:t.t_title=t.title,t.enddate&&(t.t_enddate=c()(t.enddate.toDate()).format("YYYY-MM-DD")),t.startdate&&(t.t_startdate=c()(t.startdate.toDate()).format("YYYY-MM-DD")),t.process&&(t.process.forEach((function(t){t.t_pgdate=c()(t.pgdate.toDate()).format("YYYY-MM-DD")||""})),t.process.sort((function(t,a){return c()(a.t_pgdate).diff(c()(t.t_pgdate))})));var e="";return c()(t.t_startdate)<c()()&&"完成"!=t.status?(t.remaindays=c()(c()(t.t_enddate).diff(c()())).format("D"),e=c()(t.t_enddate).diff(c()(),"day"),t.remaindays='<span class="red--text">'.concat(e,"天</span>")):t.remaindays="","完成"==t.status&&(t.title="<span class='green--text'>"+t.title+"</span>"),"不顯示"==t.status||"停止"==t.status?{}:(e<=0&&""!==e&&(t.title="<span class='red--text'>"+t.title+"</span>"),(c()().isBefore(t.t_startdate)||""==t.t_startdate)&&(t.title="<span class='grey--text'>"+t.title+"</span>"),t.ptitle=t.title,t.process&&t.process.length>0&&c()().diff(c()(t.process[0].t_pgdate),"day")<=a.ShowRecentReport&&(t.title="".concat(t.title,"-").concat(t.depart,' 【<span class="blue--text">').concat(t.process[0].t_pgdate," - ").concat(t.process[0].pgdesc,"</span>】")),t)}));this.treeData=i["a"].arrayToJson(e),this.$store.commit("setLoading",!1)},searchFun:function(){this.$refs.tree1.searchNodes(this.searchword)},tpl:function(){for(var t=this,a=this.$createElement,e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];var o=r[0],n=r[1],l=r[2],c=(r[3],o.selected?"node-title node-selected":"node-title");return o.searched&&(c+=" node-searched"),a("span",[a("span",{class:c,domProps:{innerHTML:o.title},on:{click:function(){var a;n.parent.nodeSelected(n.props.node),a=null===l?t.$store.getters.projectEndDate:l.enddate||t.$store.getters.projectEndDate;var e=K({parentEndDate:a},o);t.todo=i["a"].deepCopy(e),t.workDetailDialog=!0}}})])},getChildData:function(t){var a=this;console.log("childData",t);var e=this.$refs.tree1.getNodes();e.forEach((function(e){if(e.id===t.id){e.title=e.t_title,e.depart=t.depart,e.t_enddate=t.t_enddate,e.t_startdate=t.t_startdate,e.status=t.status,e.process=t.process,t.memo&&(e.memo=t.memo),e.process&&e.process.sort((function(t,a){return c()(a.t_pgdate).diff(c()(t.t_pgdate))}));var r="";if(r=c()(e.t_enddate).diff(c()(),"day"),"完成"==e.status&&(e.title="<span style='color: green'>"+e.title+"</span>"),"不顯示"==e.status||"停止"==e.status)return{};r<=0&&""!==r&&(e.title="<span style='color: red'>"+e.title+"</span>"),(c()().isBefore(e.t_startdate)||""==e.t_startdate)&&(e.title="<span style='color:#BDBDBD'>"+e.title+"</span>"),e.process&&e.process.length>0&&c()().diff(c()(e.process[0].t_pgdate),"day")<=a.ShowRecentReport&&(e.title="".concat(e.title,"-").concat(e.depart,' 【<span class="blue--text">').concat(e.process[0].t_pgdate," - ").concat(e.process[0].pgdesc,"</span>】"))}})),this.treeData=i["a"].arrayToJson(e);var r={depart:t.depart,enddate:new Date(c()(t.t_enddate)),startdate:new Date(c()(t.t_startdate)),status:t.status,process:t.process||[]};t.memo&&(r.memo=t.memo),n["b"].collection("TLFMCD").doc(t.id).update(r).then((function(){console.log("Document successfully Update!")}))}}},Z=U,G=e("2db4"),Q=Object(D["a"])(Z,r,s,!1,null,null,null);a["default"]=Q.exports;_()(Q,{VBtn:b["a"],VCard:x["a"],VCardText:k["d"],VCol:y["a"],VContainer:w["a"],VDialog:V["a"],VIcon:T["a"],VRow:W["a"],VSnackbar:G["a"],VSpacer:S["a"],VTextField:O["a"],VToolbar:j["a"]})},cf1c:function(t,a,e){t.exports=e.p+"img/loading.gif"}}]);