(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-269a748c"],{"0b06":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"tree"},[r("v-container",[r("v-row",[r("v-col",{staticClass:"py-0",attrs:{cols:"12",sm:"12",md:"6"}},[r("v-text-field",{attrs:{label:"關鍵字搜尋..."},model:{value:t.searchword,callback:function(e){t.searchword=e},expression:"searchword"}})],1),r("v-col",{staticClass:"py-0",attrs:{cols:"6",sm:"6",md:"1"}},[r("v-btn",{attrs:{color:"info"},on:{click:t.searchFun}},[t._v("搜尋")])],1),r("v-col",{staticClass:"py-0",attrs:{cols:"6",sm:"6",md:"2"}},[r("v-btn",{attrs:{color:"orange"},on:{click:t.nearreported}},[t._v("顯示近期填報")])],1)],1)],1),r("img",{directives:[{name:"show",rawName:"v-show",value:this.$store.state.loading,expression:"this.$store.state.loading"}],attrs:{src:a("cf1c"),height:"40px"}}),r("v-tree",{ref:"tree1",attrs:{data:t.treeData,tpl:t.tpl}}),r("v-container",[r("v-row",[r("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.workDetailDialog,callback:function(e){t.workDetailDialog=e},expression:"workDetailDialog"}},[r("v-toolbar",{attrs:{dark:"",color:"primary"}},[r("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:function(e){t.workDetailDialog=!1}}},[r("v-icon",[t._v("mdi-backspace")]),r("span",{staticClass:"title"},[t._v("退回")])],1),r("v-spacer")],1),r("v-card",{staticClass:"mx-auto",attrs:{tile:""}},[r("v-card-text",{staticClass:"px-3"},[r("workdetail",{attrs:{propData:t.todo},on:{listenToChild:t.getChildData}})],1)],1)],1)],1)],1),r("v-snackbar",{attrs:{timeout:t.timeout},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.databasemessage)+" "),r("v-btn",{attrs:{dark:"",text:""},on:{click:function(e){t.snackbar=!1}}},[t._v("Close")])],1)],1)},s=[],o=(a("a4d3"),a("99af"),a("4de4"),a("d81d"),a("4e827"),a("b0c0"),a("e439"),a("dbb4"),a("b64b"),a("159b"),a("ade3")),i=a("9138"),n=a("6fa2"),l=a("c1df"),c=a.n(l),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-card",{staticClass:"mx-auto blue lighten-5",attrs:{"max-width":"550",align:"left",outlined:""}},[a("v-card-text",[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{cols:"12"}},[a("div",{staticClass:"subtitle-1 mb-1",domProps:{innerHTML:t._s(t.propData.ptitle)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 開始日期： "),a("span",{staticClass:"body-1 blue--text",domProps:{innerHTML:t._s(t.propData.t_startdate)}})]),a("v-col",{staticClass:"mb-2",attrs:{cols:"12"}},[t._v(" 完成日期： "),a("span",{staticClass:"body-1 blue--text mb-1",domProps:{innerHTML:t._s(t.propData.t_enddate)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 負責單位： "),a("span",{staticClass:"body-1",domProps:{innerHTML:t._s(t.propData.depart)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 剩餘天數： "),a("span",{staticClass:"body-1 blue--text",domProps:{innerHTML:t._s(t.propData.remaindays)}})]),a("v-col",{attrs:{cols:"12"}},[t._v(" 狀態： "),a("span",{staticClass:"body-1",domProps:{innerHTML:t._s(t.propData.status)}})]),a("v-col",{attrs:{cols:"12"}},[a("span",{staticClass:"body-2",domProps:{innerHTML:t._s(t.propData.memo)}})])],1)],1),a("v-card-actions",[a("v-btn",{attrs:{text:"",color:"orange"},on:{click:t.workItemDetailEdit}},[t._v("編輯")]),a("v-spacer"),a("v-btn",{attrs:{text:"",color:"indigo"},on:{click:function(e){return t.ProcessAdd(t.newProcess,t.propData.id,!0,-1)}}},[t._v("進度填報")])],1)],1),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.detailEditDialog,callback:function(e){t.detailEditDialog=e},expression:"detailEditDialog"}},[a("workdetailEdit",{attrs:{propData2:t.editWorkItemDetailData},on:{listenToChild2:t.getChildData_ItemDetailEdit}})],1),a("v-card",{staticClass:"mx-auto lighten-5",staticStyle:{"border-width":"0px"},attrs:{"max-width":"550",align:"left",outlined:"",tile:""}},[a("v-card-text",{staticClass:"px-0"},[a("div",[a("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[a("thead",[a("tr",[a("th",{staticClass:"text-left"},[t._v("填報日期")]),a("th",{staticClass:"text-left"},[t._v("進度說明")]),a("th",{staticClass:"text-left"},[t._v("佐證資料")])])]),a("tbody",t._l(t.propData.process,(function(e,r){return a("tr",[a("td",{staticClass:"text-left px-0"},[a("v-menu",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(r){var s=r.on;return[a("v-btn",t._g({staticClass:"text-left px-0",attrs:{text:""}},s),[t._v(t._s(e.t_pgdate))])]}}],null,!0)},[a("v-list",[a("v-list-item",[a("v-list-item-title",{on:{click:function(a){return t.ProcessAdd(e,t.propData.id,!1,r)}}},[t._v("修改")])],1),a("v-list-item",[a("v-list-item-title",{on:{click:function(a){return t.ProcessDelete(e,t.propData.id,r)}}},[t._v("刪除")])],1)],1)],1)],1),a("td",{staticClass:"text-left"},[t._v(t._s(e.pgdesc))]),e.pdf?a("td",{staticClass:"text-center"},[a("span",{staticClass:"blue--text",on:{click:function(a){return t.openPDF(""+e.cfmpic)}}},[t._v("檢視")])]):a("td",{directives:[{name:"viewer",rawName:"v-viewer",value:{inline:!1,button:!0,navbar:!1,title:!0,toolbar:!1,tooltip:!1,movable:!1,zoomable:!0,rotatable:!1,scalable:!1,transition:!1,fullscreen:!0,keyboard:!0,url:"data-source"},expression:"{'inline': false, 'button': true, 'navbar': false, 'title': true, 'toolbar': false, 'tooltip': false, 'movable': false, 'zoomable': true, 'rotatable': false, 'scalable': false, 'transition': false, 'fullscreen': true, 'keyboard': true, 'url': 'data-source' }"}],domProps:{innerHTML:t._s("<img src='"+e.cfmpic+"' style='height:80px;width:80px'>")}})])})),0)]},proxy:!0}])})],1)]),a("v-card-actions")],1),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-right-transition"},model:{value:t.ProcessAddDialog,callback:function(e){t.ProcessAddDialog=e},expression:"ProcessAddDialog"}},[a("workProcessAdd",{attrs:{propData4:t.ProcessAddData,addProcess:t.addProcess,ProcessNodeId:t.ProcessNodeId,ProcessItemIndex:t.ProcessItemIndex},on:{listenToChild4:t.getChildData_ProcessAdd}})],1),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.PDFdialog,callback:function(e){t.PDFdialog=e},expression:"PDFdialog"}},[a("v-card",[a("v-toolbar",{attrs:{dark:"",color:"primary"}},[a("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:function(e){t.PDFdialog=!1}}},[a("v-icon",[t._v("mdi-backspace")]),a("span",{staticClass:"title"},[t._v("關閉")])],1)],1),a("v-card-text",{staticClass:"px-0"},[a("iframe",{ref:"PDFiframe",attrs:{id:"PDFiframe",src:t.PDFURL,width:"100%",height:"1500px",frameborder:"0"}})])],1)],1)],1)},p=[],u=(a("a434"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-toolbar",{attrs:{dark:"",color:"orange"}},[a("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:t.recordClose}},[a("v-icon",[t._v("mdi-backspace")]),a("span",{staticClass:"title"},[t._v("退回")])],1),a("v-spacer"),a("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:t.recordSave}},[a("v-icon",[t._v("mdi-content-save-outline")]),a("span",{staticClass:"title"},[t._v("儲存")])],1)],1),a("v-card",{attrs:{height:"100vh"}},[a("v-card-title",[t._v("基本資料編輯")]),a("v-card-text",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[a("v-container",{staticClass:"text-center"},[a("div",{staticClass:"text-center mb-4"},[a("v-overlay",{attrs:{opacity:.5,"z-index":"1",value:t.alert}},[a("v-alert",{attrs:{color:"red",dark:"",transition:"scale-transition"}},[t._v(t._s(t.alertResult))])],1)],1),a("v-col",{attrs:{cols:"12"}},[a("v-dialog",{ref:"startDateDialog",attrs:{"return-value":t.propData2.t_startdate,persistent:"",width:"290px"},on:{"update:returnValue":function(e){return t.$set(t.propData2,"t_startdate",e)},"update:return-value":function(e){return t.$set(t.propData2,"t_startdate",e)}},scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on;return[a("v-text-field",t._g({attrs:{label:"開始日期",rules:[t.rules.required],readonly:""},model:{value:t.propData2.t_startdate,callback:function(e){t.$set(t.propData2,"t_startdate",e)},expression:"propData2.t_startdate"}},r))]}}]),model:{value:t.startDateDialogModal,callback:function(e){t.startDateDialogModal=e},expression:"startDateDialogModal"}},[a("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData2.t_startdate,callback:function(e){t.$set(t.propData2,"t_startdate",e)},expression:"propData2.t_startdate"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.startDateDialogModal=!1}}},[t._v("Cancel")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.startDateDialog.save(t.propData2.t_startdate)}}},[t._v("OK")])],1)],1)],1),a("v-col",{attrs:{cols:"12"}},[a("v-dialog",{ref:"endDateDialog",attrs:{"return-value":t.propData2.t_enddate,persistent:"",width:"290px"},on:{"update:returnValue":function(e){return t.$set(t.propData2,"t_enddate",e)},"update:return-value":function(e){return t.$set(t.propData2,"t_enddate",e)}},scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on;return[a("v-text-field",t._g({attrs:{label:"結束日期",rules:[t.rules.required],readonly:""},model:{value:t.propData2.t_enddate,callback:function(e){t.$set(t.propData2,"t_enddate",e)},expression:"propData2.t_enddate"}},r))]}}]),model:{value:t.endDateDialogModal,callback:function(e){t.endDateDialogModal=e},expression:"endDateDialogModal"}},[a("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData2.t_enddate,callback:function(e){t.$set(t.propData2,"t_enddate",e)},expression:"propData2.t_enddate"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.endDateDialogModal=!1}}},[t._v("Cancel")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.endDateDialog.save(t.propData2.t_enddate)}}},[t._v("OK")])],1)],1)],1),a("v-col",{attrs:{cols:"12"}},[a("v-select",{attrs:{items:t.depart,label:"負責單位"},model:{value:t.propData2.depart,callback:function(e){t.$set(t.propData2,"depart",e)},expression:"propData2.depart"}})],1),a("v-col",{attrs:{cols:"12"}},[a("v-select",{attrs:{label:"狀態",items:t.status,rules:[t.rules.required]},model:{value:t.propData2.status,callback:function(e){t.$set(t.propData2,"status",e)},expression:"propData2.status"}})],1),a("v-col",{attrs:{cols:"12"}},[a("v-textarea",{attrs:{"auto-grow":"",color:"deep-purple",label:"備註",rows:"1",rules:[t.rules.length(50)]},model:{value:t.propData2.memo,callback:function(e){t.$set(t.propData2,"memo",e)},expression:"propData2.memo"}})],1)],1)],1)],1)],1)],1)}),v=[],f=(a("466d"),{name:"workdetailEdit",props:["propData2"],data:function(){return{alertResult:"",alert:!1,valid:!1,rules:{email:function(t){return(t||"").match(/@/)||"Please enter a valid email"},length:function(t){return function(e){return(e||"").length<=t||"最多".concat(t,"個字元")}},password:function(t){return(t||"").match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*(_|[^\w])).+$/)||"Password must contain an upper case letter, a numeric character, and a special character"},required:function(t){return!!t||"這個欄位必須要輸入"}},startDateDialogModal:!1,endDateDialogModal:!1,depart:[],status:[]}},components:{},created:function(){var t=this;i["c"].collection("SettingData").doc("Department").get().then((function(e){var a=e.data().depart;a.sort((function(t,e){return t.order-e.order})).forEach((function(e){t.depart.push(e.title)}))})),i["c"].collection("SettingData").doc("WorkItemStatus").get().then((function(e){t.status=e.data().status}))},mounted:function(){},watch:{},computed:{},methods:{recordClose:function(){this.$emit("listenToChild2",!1)},recordSave:function(){return c()(this.propData2.t_startdate).isAfter(this.propData2.t_enddate)?(this.ShowAlert("開始日期 ＞ 結束日期！"),!1):this.$refs.form.validate()?(console.log("else",this.$refs.form.validate()),void this.$emit("listenToChild2",this.propData2)):(console.log(this.$refs.form.validate()),this.ShowAlert("輸入資料有錯誤！"),!1)},ShowAlert:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.alertResult=t,this.alert=!0,setTimeout((function(){e.alertResult="",e.alert=!1}),a)}}}),g=f,m=a("2877"),h=a("6544"),D=a.n(h),_=a("0798"),b=a("8336"),x=a("b0af"),k=a("99d9"),y=a("62ad"),w=a("a523"),P=a("2e4b"),C=a("169a"),V=a("4bd4"),I=a("132d"),S=a("a797"),$=a("b974"),F=a("2fa4"),T=a("8654"),E=a("a844"),M=a("71d9"),L=Object(m["a"])(g,u,v,!1,null,null,null),A=L.exports;D()(L,{VAlert:_["a"],VBtn:b["a"],VCard:x["a"],VCardText:k["d"],VCardTitle:k["e"],VCol:y["a"],VContainer:w["a"],VDatePicker:P["a"],VDialog:C["a"],VForm:V["a"],VIcon:I["a"],VOverlay:S["a"],VSelect:$["a"],VSpacer:F["a"],VTextField:T["a"],VTextarea:E["a"],VToolbar:M["a"]});var O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-toolbar",{attrs:{dark:"",color:"indigo"}},[a("v-btn",{staticClass:"px-0",attrs:{dark:"",text:""},on:{click:t.ProcessClose}},[a("v-icon",[t._v("mdi-backspace")]),a("span",{staticClass:"title"},[t._v("退回")])],1),a("v-spacer")],1),a("v-card",{attrs:{height:"100vh"}},[a("v-card-title",[t._v(t._s(t.addProcess?"新增":"修改已")+"填報資料")]),a("v-card-text",{staticClass:"pb-0"},[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[a("v-container",{staticClass:"text-center pb-0"},[a("div",{staticClass:"text-center mb-4"},[a("v-overlay",{attrs:{opacity:.5,"z-index":"1",value:t.alert}},[a("v-alert",{attrs:{color:"red",dark:"",transition:"scale-transition"}},[t._v(t._s(t.alertResult))])],1)],1),a("v-col",{attrs:{cols:"12"}},[a("v-dialog",{ref:"startDateDialog",attrs:{"return-value":t.propData4.t_pgdate,persistent:"",width:"290px"},on:{"update:returnValue":function(e){return t.$set(t.propData4,"t_pgdate",e)},"update:return-value":function(e){return t.$set(t.propData4,"t_pgdate",e)}},scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on;return[a("v-text-field",t._g({attrs:{label:"填報日期",rules:[t.rules.required],readonly:""},model:{value:t.propData4.t_pgdate,callback:function(e){t.$set(t.propData4,"t_pgdate",e)},expression:"propData4.t_pgdate"}},r))]}}]),model:{value:t.startDateDialogModal,callback:function(e){t.startDateDialogModal=e},expression:"startDateDialogModal"}},[a("v-date-picker",{attrs:{"first-day-of-week":"1",locale:"zh-TW",scrollable:""},model:{value:t.propData4.t_pgdate,callback:function(e){t.$set(t.propData4,"t_pgdate",e)},expression:"propData4.t_pgdate"}},[a("v-spacer"),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.startDateDialogModal=!1}}},[t._v("Cancel")]),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.startDateDialog.save(t.propData4.t_pgdate)}}},[t._v("OK")])],1)],1)],1),a("v-col",{staticClass:"pb-0",attrs:{cols:"12"}},[a("v-text-field",{attrs:{label:"進度說明",rules:[t.rules.required,t.rules.length(25)],counter:25},model:{value:t.propData4.pgdesc,callback:function(e){t.$set(t.propData4,"pgdesc",e)},expression:"propData4.pgdesc"}})],1),a("v-col",{staticClass:"pa-0",attrs:{cols:"12",align:"right"}},[""!==t.propData4.cfmpic&&3!==t.e1?a("v-btn",{attrs:{text:"",color:"orange"},on:{click:t.ProcessSave}},[t._v("進度說明存檔")]):t._e()],1)],1)],1)],1),[a("v-stepper",{attrs:{vertical:""},model:{value:t.e1,callback:function(e){t.e1=e},expression:"e1"}},[a("v-stepper-header",[a("v-stepper-step",{attrs:{complete:t.e1>1,step:"1"}},[t._v("步驟1")]),a("v-divider"),a("v-stepper-step",{attrs:{complete:t.e1>2,step:"2"}},[t._v("步驟2")]),a("v-divider"),a("v-stepper-step",{attrs:{step:"3"}},[t._v("步驟3")])],1),a("v-stepper-items",[a("v-stepper-content",{attrs:{step:"1"}},[a("v-card",{staticClass:"mb-2",attrs:{color:"grey lighten-2"}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-col",{attrs:{cols:"12"}},[""==t.propData4.cfmpic||t.propData4.pdf?t._e():a("div",[a("v-img",{attrs:{src:t.propData4.cfmpic,"max-width":"100"}})],1),t.propData4.pdf?a("div",[t._v("PDF")]):t._e(),t.progress>0?a("span",{attrs:{id:"progress"}},[a("v-progress-circular",{attrs:{size:100,width:15,rotate:-90,value:t.progress,color:"primary"}},[t._v(t._s(t.progress))])],1):t._e(),a("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{id:"inputimage",type:"file",accept:"image/*, .pdf"},on:{change:t.handleFileSelect}})])],1)],1),a("v-btn",{attrs:{color:"primary"},on:{click:function(e){return t.$refs.fileInput.click()}}},[t._v("佐證資料")])],1),a("v-stepper-content",{attrs:{step:"2"}},[a("v-card",{staticClass:"mb-2",attrs:{color:"grey lighten-2"}},[a("v-row",{attrs:{align:"center",justify:"center"}},[t._l(t.imageFiles,(function(e,r){return a("div",[a("span",{staticClass:"delbtn",on:{click:function(e){return t.delImage(r)}}},[a("v-icon",{attrs:{large:"",color:""}},[t._v("mdi-delete-forever")])],1),t._v(" "+t._s(e.filename)+" "),a("br"),a("div",[a("img",{staticStyle:{width:"100px"},attrs:{src:e.imageDataUrl}}),a("br"),e.GPSLatitude?a("div",[t._v(" 緯度："+t._s(e.GPSLatitude)+" "),a("br"),t._v(" 經度："+t._s(e.GPSLongitude)+" ")]):t._e()])])})),t.progress>0?a("span",{attrs:{id:"progress"}},[a("v-progress-circular",{attrs:{size:100,width:15,rotate:-90,value:t.progress,color:"primary"}},[t._v(t._s(t.progress))])],1):t._e()],2)],1),a("v-btn",{attrs:{color:"primary"},on:{click:function(e){return t.uploadImage()}}},[t._v("上傳圖檔")]),a("v-btn",{attrs:{text:""},on:{click:t.ProcessClose}},[t._v("取消")])],1),a("v-stepper-content",{attrs:{step:"3"}},[a("v-card",{staticClass:"mb-2",attrs:{color:"grey lighten-2"}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-col",{attrs:{cols:"12"}},[""==t.propData4.cfmpic||t.propData4.pdf?t._e():a("div",[a("v-img",{attrs:{src:t.propData4.cfmpic,"max-width":"100"}})],1),t.propData4.pdf?a("div",[t._v("PDF")]):t._e(),t.progress>0?a("div",{attrs:{id:"progress"}},[a("v-progress-circular",{attrs:{size:100,width:15,rotate:-90,value:t.progress,color:"primary"}},[t._v(t._s(t.progress))])],1):t._e()])],1)],1),a("v-btn",{attrs:{color:"orange"},on:{click:t.ProcessSave}},[t._v("完成並存檔")]),a("v-btn",{attrs:{text:""},on:{click:t.ProcessClose}},[t._v("取消")])],1)],1)],1)]],2)],1)},R=[],j=(a("7db0"),a("fb6a"),{name:"workProcessAdd",props:["propData4","ProcessNodeId","addProcess","ProcessItemIndex"],data:function(){return{alertResult:"",alert:!1,valid:!1,rules:{length:function(t){return function(e){return(e||"").length<=t||"最多".concat(t,"個字元")}},required:function(t){return!!t||"這個欄位必須要輸入"},size:function(t){return!t||t.size<2e6||"頭相照片尺寸小於 2 MB！，不清楚"}},startDateDialogModal:!1,imageFiles:[],progress:0,e1:1,steps:2}},components:{},created:function(){},mounted:function(){},watch:{},computed:{hasImage:function(){return this.imageFiles.length>0}},methods:{ProcessSave:function(){if(!this.$refs.form.validate())return!1;this.imageFiles=[],document.getElementById("inputimage").value="",this.progress=0,this.$emit("listenToChild4",this.propData4,this.ProcessNodeId,this.addProcess,this.ProcessItemIndex),this.e1=1},ProcessClose:function(){this.imageFiles=[],document.getElementById("inputimage").value="",this.progress=0,this.e1=1,this.$emit("listenToChild4",!1)},handleFileSelect:function(t){var e=this,a=null;if(t.target.files&&window.FileReader){var r=t.target.files,s=Array.prototype.slice.call(r),o=s[0];if("application/pdf"!=o.type)s.forEach((function(t,r){if(t.type.match("image.*")){e.imageFiles.unshift({filename:"",imageDataUrl:"",EXIF:{},discription:"",GPSLatitude:0,GPSLongitude:0});var s=new FileReader,o=new Image;EXIF.getData(t,(function(){a=EXIF.getTag(this,"Orientation");var t=EXIF.getTag(this,"GPSLatitudeRef"),s=EXIF.getTag(this,"GPSLatitude"),o=EXIF.getTag(this,"GPSLongitudeRef"),i=EXIF.getTag(this,"GPSLongitude");void 0!=t&&void 0!=o&&void 0!=i&&void 0!=i&&(e.imageFiles[r].GPSLatitude="N"==t?n["a"].change_latlng(s):-1*n["a"].change_latlng(s),e.imageFiles[r].GPSLongitude="E"==o?n["a"].change_latlng(i):-1*n["a"].change_latlng(i))})),s.onload=function(s){o.src=s.target.result,o.onload=function(){var s=this.width,o=this.height;s>o&&s>750?(s=750,o=Math.ceil(750*this.height/this.width)):s<o&&o>1334&&(s=Math.ceil(1334*this.width/this.height),o=1334);var i=document.createElement("canvas"),n=i.getContext("2d");if(i.width=s,i.height=o,a&&1!=a)switch(a){case 6:i.width=o,i.height=s,n.rotate(Math.PI/2),n.drawImage(this,0,-o,s,o);break;case 3:n.rotate(Math.PI),n.drawImage(this,-s,-o,s,o);break;case 8:i.width=o,i.height=s,n.rotate(3*Math.PI/2),n.drawImage(this,-s,0,s,o);break}else n.drawImage(this,0,0,s,o);e.imageFiles[r].imageDataUrl=i.toDataURL("image/jpeg",.8),e.imageFiles[r].filename="image.jpg"==t.name?Math.floor(Date.now()/1e3)+".jpg":Math.floor(Date.now()/1e3)+t.name}},s.readAsDataURL(t)}})),this.e1=2;else{var l=+new Date+"-"+o.name,c={contentType:o.type},d=i["e"].ref().child("/"+i["a"]+"/"+e.ProcessNodeId+"/"+l).put(o,c);d.on("state_changed",(function(t){e.progress=t.bytesTransferred/t.totalBytes*100}),(function(t){}),(function(){d.snapshot.ref.getDownloadURL().then((function(t){e.propData4.cfmpic=t,e.propData4.pickey="/"+i["a"]+"/"+e.ProcessNodeId+"/"+l,e.propData4.pdf=!0,e.e1=3}))}))}}},dellatlng:function(t){var e=confirm("刪除GPS資料？");if(e){var a=this,r=a.data1.find((function(t){return t.id==a.tid}));r.images[t].key;r.images[t].center.lat=0,r.images[t].center.lng=0,place_data.set(a.data1)}},delImage:function(t){this.imageFiles.shift(t),this.e1=1},removeImage:function(t){this.imageFiles=[]},uploadImage:function(){var t=this,e=t.imageFiles;e.forEach((function(e,a,r){var s=i["e"].ref().child("/"+i["a"]+"/"+t.ProcessNodeId+"/"+e.filename).putString(e.imageDataUrl,"data_url");s.on("state_changed",(function(e){t.progress=e.bytesTransferred/e.totalBytes*100}),(function(t){console.log(t),alert("上傳圖片有錯誤！")}),(function(){s.snapshot.ref.getDownloadURL().then((function(a){t.propData4.cfmpic=a,t.propData4.pickey="/"+i["a"]+"/"+t.ProcessNodeId+"/"+e.filename,t.imageFiles=[],t.e1=3,t.progress=0}))}))}))}}}),U=j,Y=a("ce7e"),z=a("adda"),N=a("490a"),B=a("0fd9"),H=a("7e85"),G=a("e516"),q=a("9c54"),W=a("56a4"),X=Object(m["a"])(U,O,R,!1,null,"2c342424",null),J=X.exports;D()(X,{VAlert:_["a"],VBtn:b["a"],VCard:x["a"],VCardText:k["d"],VCardTitle:k["e"],VCol:y["a"],VContainer:w["a"],VDatePicker:P["a"],VDialog:C["a"],VDivider:Y["a"],VForm:V["a"],VIcon:I["a"],VImg:z["a"],VOverlay:S["a"],VProgressCircular:N["a"],VRow:B["a"],VSpacer:F["a"],VStepper:H["a"],VStepperContent:G["a"],VStepperHeader:q["c"],VStepperItems:q["d"],VStepperStep:W["a"],VTextField:T["a"],VToolbar:M["a"]});var K={name:"workdetail",props:["propData"],data:function(){return{detailEditDialog:!1,editWorkItemDetailData:{},ProcessAddDialog:!1,ProcessAddData:{},addProcess:!0,ProcessNodeId:"",ProcessItemIndex:-1,newProcess:{cfmpic:"",pgdate:new Date(c()()),pgdesc:"",pickey:"",t_pgdate:c()().format("YYYY-MM-DD")},PDFdialog:!1,PDFURL:"",iframeHeight:"1000 px"}},components:{workdetailEdit:A,workProcessAdd:J},created:function(){},mounted:function(){},watch:{},computed:{},methods:{workItemDetailEdit:function(){this.detailEditDialog=!0,this.editWorkItemDetailData=this.propData},getChildData_ItemDetailEdit:function(t){if(this.detailEditDialog=!1,!t)return!1;this.propData.title=this.propData.t_title,this.propData.depart=t.depart,this.propData.t_enddate=t.t_enddate,this.propData.t_startdate=t.t_startdate,this.propData.status=t.status,this.propData.process=t.process,t.memo&&(this.propData.memo=t.memo);var e="";c()(this.propData.t_startdate)<c()()&&"完成"!=this.propData.status?(this.propData.remaindays=c()(c()(this.propData.t_enddate).diff(c()())).format("D"),e=c()(this.propData.t_enddate).diff(c()(),"day"),this.propData.remaindays='<span class="red--text">'.concat(e,"天</span>")):this.propData.remaindays="",this.$emit("listenToChild",t),this.dialog=!1},ProcessAdd:function(t,e,a,r){this.addProcess=a,this.ProcessAddDialog=!0,this.ProcessNodeId=e,this.ProcessItemIndex=r,this.ProcessAddData=a?Object.assign({},t):t,console.log(this.ProcessAddData)},getChildData_ProcessAdd:function(t,e,a,r){if(this.ProcessAddDialog=!1,!t)return!1;t.pgdate=new Date(c()(t.t_pgdate)),a?(this.propData.process.unshift(t),console.log("propData",this.propData)):(Object.assign(this.propData.process[r],t),console.log(this.propData),this.$forceUpdate());var s={process:this.propData.process};console.log("updateData",s),i["c"].collection(i["a"]).doc(e).update(s).then((function(){console.log("Document successfully Update!")})).catch((function(t){console.log("Uh-oh, an error occurred!")}))},ProcessDelete:function(t,e,a){var r=this;return console.log(this.propData,t,e,a),this.$dialog["warning"]({title:"警告",text:"確定要刪除這個進度嗎？",persistent:!1}).then((function(s){if(s){var o={process:r.propData.process};o.process.splice(a,1),i["c"].collection(i["a"]).doc(e).update(o).then((function(){console.log("Document successfully Update!")})).catch((function(t){console.log("Uh-oh, an error occurred!")})),console.log(t.pickey),""!=t.pickey&&i["e"].ref().child(t.pickey).delete()}})),this.ProcessAddDialog=!0,!1},openPDF:function(t){this.setiframe("PDFiframe"),this.PDFURL=t,this.PDFdialog=!0},setiframe:function(t){var e=this.$refs.PDFiframe,a=Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight);e&&(e.height=a+"px")}}},Z=K,Q=a("8860"),tt=a("da13"),et=a("5d23"),at=a("e449"),rt=a("1f4f"),st=Object(m["a"])(Z,d,p,!1,null,null,null),ot=st.exports;function it(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function nt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?it(Object(a),!0).forEach((function(e){Object(o["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):it(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}D()(st,{VBtn:b["a"],VCard:x["a"],VCardActions:k["b"],VCardText:k["d"],VCol:y["a"],VDialog:C["a"],VIcon:I["a"],VList:Q["a"],VListItem:tt["a"],VListItemTitle:et["k"],VMenu:at["a"],VRow:B["a"],VSimpleTable:rt["a"],VSpacer:F["a"],VToolbar:M["a"]});var lt={name:"worklist",data:function(){return{workDetailDialog:!1,searchword:"",treeData:[],db_data:[],todo:{},ShowRecentReport:10,snackbar:!1,timeout:2e3,databasemessage:""}},components:{workdetail:ot},created:function(){var t=this;this.$store.commit("setLoading",!0),i["c"].collection(i["a"]).onSnapshot((function(e){var a=e.docChanges();a.forEach((function(e){"added"!==e.type||t.$store.state.loading||(t.databasemessage=t.$store.getters.user.name+" 正在新增資料！",t.snackbar=!0),"modified"===e.type&&(t.databasemessage=t.$store.getters.user.name+" 已經修改資料！",t.snackbar=!0),"removed"===e.type&&(t.databasemessage=t.$store.getters.user.name+" 已經刪除資料！",t.snackbar=!0)}))}))},mounted:function(){this.readData()},watch:{},computed:{},methods:{nearreported:function(){var t=this;this.$dialog.prompt({text:"天數",title:"顯示幾天內填報的資料："}).then((function(e){t.ShowRecentReport=e,t.handleData(t.db_data)}))},readData:function(){var t=this;i["c"].collection(i["a"]).get().then((function(e){e.forEach((function(e){t.db_data.push(e.data())})),t.handleData(t.db_data)}))},handleData:function(t){var e=this,a=t.map((function(t){t.t_title?t.title=t.t_title:t.t_title=t.title,t.enddate&&(t.t_enddate=c()(t.enddate.toDate()).format("YYYY-MM-DD")),t.startdate&&(t.t_startdate=c()(t.startdate.toDate()).format("YYYY-MM-DD")),t.process&&(t.process.forEach((function(t){t.t_pgdate=c()(t.pgdate.toDate()).format("YYYY-MM-DD")||""})),t.process.sort((function(t,e){return c()(e.t_pgdate).diff(c()(t.t_pgdate))})));var a="";return c()(t.t_startdate)<c()()&&"完成"!=t.status?(t.remaindays=c()(c()(t.t_enddate).diff(c()())).format("D"),a=c()(t.t_enddate).diff(c()(),"day"),t.remaindays='<span class="red--text">'.concat(a,"天</span>")):t.remaindays="","完成"==t.status&&(t.title="<span class='green--text'>"+t.title+"</span>"),"不顯示"==t.status||"停止"==t.status?{}:(a<=0&&""!==a&&(t.title="<span class='red--text'>"+t.title+"</span>"),(c()().isBefore(t.t_startdate)||""==t.t_startdate)&&(t.title="<span class='grey--text'>"+t.title+"</span>"),t.ptitle=t.title,t.process&&t.process.length>0&&(0==e.ShowRecentReport?t.title=t.title:c()().diff(c()(t.process[0].t_pgdate),"day")<=e.ShowRecentReport&&(t.title="".concat(t.title,"-").concat(t.depart,' 【<span class="blue--text">').concat(t.process[0].t_pgdate," - ").concat(t.process[0].pgdesc,"</span>】"))),t)}));this.treeData=n["a"].arrayToJson(a),this.$store.commit("setLoading",!1)},searchFun:function(){this.$refs.tree1.searchNodes(this.searchword)},tpl:function(){for(var t=this,e=this.$createElement,a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];var o=r[0],i=r[1],n=r[2],l=(r[3],o.selected?"node-title node-selected":"node-title");return o.searched&&(l+=" node-searched"),e("span",[e("span",{class:l,domProps:{innerHTML:o.title},on:{click:function(){var e;i.parent.nodeSelected(i.props.node),e=null===n?t.$store.getters.projectEndDate:n.enddate||t.$store.getters.projectEndDate,t.todo=nt({parentEndDate:e},o),t.workDetailDialog=!0}}})])},getChildData:function(t){var e=this;console.log("childData",t);var a=this.$refs.tree1.getNodes();a.forEach((function(a){if(a.id===t.id){a.title=a.t_title,a.depart=t.depart,a.t_enddate=t.t_enddate,a.t_startdate=t.t_startdate,a.status=t.status,a.process=t.process,t.memo&&(a.memo=t.memo),a.process&&a.process.sort((function(t,e){return c()(e.t_pgdate).diff(c()(t.t_pgdate))}));var r="";if(r=c()(a.t_enddate).diff(c()(),"day"),"完成"==a.status&&(a.title="<span style='color: green'>"+a.title+"</span>"),"不顯示"==a.status||"停止"==a.status)return{};r<=0&&""!==r&&(a.title="<span style='color: red'>"+a.title+"</span>"),(c()().isBefore(a.t_startdate)||""==a.t_startdate)&&(a.title="<span style='color:#BDBDBD'>"+a.title+"</span>"),a.process&&a.process.length>0&&c()().diff(c()(a.process[0].t_pgdate),"day")<=e.ShowRecentReport&&(a.title="".concat(a.title,"-").concat(a.depart,' 【<span class="blue--text">').concat(a.process[0].t_pgdate," - ").concat(a.process[0].pgdesc,"</span>】"))}})),this.treeData=n["a"].arrayToJson(a);var r={depart:t.depart,enddate:new Date(c()(t.t_enddate)),startdate:new Date(c()(t.t_startdate)),status:t.status,process:t.process||[]};t.memo&&(r.memo=t.memo),i["c"].collection(i["a"]).doc(t.id).update(r).then((function(){console.log("Document successfully Update!")}))}}},ct=lt,dt=a("2db4"),pt=Object(m["a"])(ct,r,s,!1,null,null,null);e["default"]=pt.exports;D()(pt,{VBtn:b["a"],VCard:x["a"],VCardText:k["d"],VCol:y["a"],VContainer:w["a"],VDialog:C["a"],VIcon:I["a"],VRow:B["a"],VSnackbar:dt["a"],VSpacer:F["a"],VTextField:T["a"],VToolbar:M["a"]})},cf1c:function(t,e,a){t.exports=a.p+"img/loading.gif"}}]);